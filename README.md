# äº¤é€šæµé‡ç›‘æµ‹æ£€æµ‹ç³»ç»Ÿæºç åˆ†äº«
 # [ä¸€æ¡é¾™æ•™å­¦YOLOV8æ ‡æ³¨å¥½çš„æ•°æ®é›†ä¸€é”®è®­ç»ƒ_70+å…¨å¥—æ”¹è¿›åˆ›æ–°ç‚¹å‘åˆŠ_Webå‰ç«¯å±•ç¤º]

### 1.ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

é¡¹ç›®å‚è€ƒ[AAAI Association for the Advancement of Artificial Intelligence](https://gitee.com/qunmasj/projects)

é¡¹ç›®æ¥æº[AACV Association for the Advancement of Computer Vision](https://github.com/qunshansj/good)

ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

éšç€åŸå¸‚åŒ–è¿›ç¨‹çš„åŠ å¿«ï¼Œäº¤é€šæµé‡çš„ç›‘æµ‹ä¸ç®¡ç†æˆä¸ºç°ä»£åŸå¸‚å‘å±•çš„é‡è¦è¯¾é¢˜ã€‚äº¤é€šæµé‡çš„æœ‰æ•ˆç›‘æµ‹ä¸ä»…èƒ½å¤Ÿæé«˜äº¤é€šç®¡ç†çš„æ•ˆç‡ï¼Œè¿˜èƒ½ä¸ºåŸå¸‚è§„åˆ’ã€ç¯å¢ƒä¿æŠ¤å’Œå…¬å…±å®‰å…¨æä¾›é‡è¦çš„æ•°æ®æ”¯æŒã€‚ä¼ ç»Ÿçš„äº¤é€šç›‘æµ‹æ–¹æ³•å¤šä¾èµ–äºäººå·¥è§‚å¯Ÿå’Œå›ºå®šæ‘„åƒå¤´ï¼Œè¿™äº›æ–¹æ³•åœ¨å‡†ç¡®æ€§ã€å®æ—¶æ€§å’Œè¦†ç›–èŒƒå›´ä¸Šå‡å­˜åœ¨ä¸€å®šçš„å±€é™æ€§ã€‚å› æ­¤ï¼ŒåŸºäºè®¡ç®—æœºè§†è§‰å’Œæ·±åº¦å­¦ä¹ æŠ€æœ¯çš„è‡ªåŠ¨åŒ–äº¤é€šæµé‡ç›‘æµ‹ç³»ç»Ÿé€æ¸æˆä¸ºç ”ç©¶çš„çƒ­ç‚¹ã€‚

è¿‘å¹´æ¥ï¼ŒYOLOï¼ˆYou Only Look Onceï¼‰ç³»åˆ—ç›®æ ‡æ£€æµ‹ç®—æ³•å› å…¶é«˜æ•ˆæ€§å’Œå®æ—¶æ€§åœ¨äº¤é€šç›‘æµ‹é¢†åŸŸå¾—åˆ°äº†å¹¿æ³›åº”ç”¨ã€‚YOLOv8ä½œä¸ºè¯¥ç³»åˆ—çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¿›ä¸€æ­¥æå‡äº†æ£€æµ‹ç²¾åº¦å’Œé€Ÿåº¦ï¼Œèƒ½å¤Ÿåœ¨å¤æ‚çš„äº¤é€šç¯å¢ƒä¸­å¿«é€Ÿè¯†åˆ«å’Œåˆ†ç±»å¤šç§äº¤é€šå‚ä¸è€…ã€‚ç„¶è€Œï¼Œç°æœ‰çš„YOLOv8æ¨¡å‹åœ¨ç‰¹å®šåœºæ™¯ä¸‹ä»ç„¶é¢ä¸´ç€æ£€æµ‹ç²¾åº¦ä¸è¶³å’Œå¯¹å°ç›®æ ‡è¯†åˆ«èƒ½åŠ›å¼±ç­‰é—®é¢˜ã€‚å› æ­¤ï¼Œé’ˆå¯¹è¿™äº›ä¸è¶³ï¼Œæ”¹è¿›YOLOv8æ¨¡å‹ä»¥æå‡å…¶åœ¨äº¤é€šæµé‡ç›‘æµ‹ä¸­çš„åº”ç”¨æ•ˆæœæ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚

æœ¬ç ”ç©¶åŸºäºä¸€ä¸ªåŒ…å«7354å¼ å›¾åƒçš„äº¤é€šå¯†åº¦æ•°æ®é›†ï¼Œæ¶µç›–äº†8ç±»äº¤é€šå‚ä¸è€…ï¼ŒåŒ…æ‹¬è‡ªè¡Œè½¦ã€ç”µåŠ¨è‡ªè¡Œè½¦ã€å‰æ™®è½¦ã€æ‘©æ‰˜è½¦ã€è¡Œäººã€ä¸‰è½®è½¦ã€å¡è½¦å’Œè½¦è¾†ã€‚è¿™ä¸€æ•°æ®é›†çš„å¤šæ ·æ€§ä¸ºæ¨¡å‹çš„è®­ç»ƒå’Œæµ‹è¯•æä¾›äº†ä¸°å¯Œçš„æ ·æœ¬ï¼Œæœ‰åŠ©äºæé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›å’Œé€‚åº”æ€§ã€‚é€šè¿‡å¯¹æ•°æ®é›†çš„æ·±å…¥åˆ†æï¼Œå¯ä»¥è¯†åˆ«å‡ºä¸åŒäº¤é€šå‚ä¸è€…åœ¨å„ç§äº¤é€šç¯å¢ƒä¸‹çš„ç‰¹å¾ï¼Œä»è€Œä¸ºæ”¹è¿›YOLOv8æ¨¡å‹æä¾›æ•°æ®æ”¯æŒã€‚

æœ¬ç ”ç©¶çš„æ„ä¹‰ä¸ä»…åœ¨äºæå‡äº¤é€šæµé‡ç›‘æµ‹çš„æŠ€æœ¯æ°´å¹³ï¼Œæ›´åœ¨äºä¸ºæ™ºèƒ½äº¤é€šç³»ç»Ÿçš„å»ºè®¾æä¾›å¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡æ”¹è¿›YOLOv8æ¨¡å‹ï¼Œèƒ½å¤Ÿå®ç°å¯¹äº¤é€šæµé‡çš„å®æ—¶ç›‘æµ‹ä¸åˆ†æï¼Œä¸ºäº¤é€šç®¡ç†éƒ¨é—¨æä¾›å‡†ç¡®çš„æ•°æ®æ”¯æŒï¼Œè¿›è€Œä¼˜åŒ–äº¤é€šä¿¡å·æ§åˆ¶ã€å‡å°‘äº¤é€šæ‹¥å µã€æé«˜é“è·¯å®‰å…¨æ€§ã€‚æ­¤å¤–ï¼Œç ”ç©¶æˆæœè¿˜å¯ä»¥ä¸ºåŸå¸‚è§„åˆ’æä¾›å‚è€ƒä¾æ®ï¼Œå¸®åŠ©å†³ç­–è€…åˆ¶å®šæ›´ä¸ºç§‘å­¦çš„äº¤é€šæ”¿ç­–ï¼Œä¿ƒè¿›å¯æŒç»­å‘å±•ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼ŒåŸºäºæ”¹è¿›YOLOv8çš„äº¤é€šæµé‡ç›‘æµ‹ç³»ç»Ÿçš„ç ”ç©¶ï¼Œä¸ä»…å…·æœ‰é‡è¦çš„ç†è®ºä»·å€¼ï¼Œè¿˜æœ‰ç€å¹¿æ³›çš„åº”ç”¨å‰æ™¯ã€‚é€šè¿‡æœ¬ç ”ç©¶ï¼ŒæœŸæœ›èƒ½å¤Ÿæ¨åŠ¨äº¤é€šç›‘æµ‹æŠ€æœ¯çš„è¿›æ­¥ï¼Œä¸ºæ™ºæ…§åŸå¸‚çš„å»ºè®¾è´¡çŒ®åŠ›é‡ã€‚åŒæ—¶ï¼Œç ”ç©¶è¿‡ç¨‹ä¸­ç§¯ç´¯çš„æ•°æ®å’Œç»éªŒä¹Ÿå°†ä¸ºåç»­ç›¸å…³ç ”ç©¶æä¾›å®è´µçš„å‚è€ƒï¼Œä¿ƒè¿›äº¤é€šå·¥ç¨‹å’Œè®¡ç®—æœºè§†è§‰é¢†åŸŸçš„äº¤å‰èåˆã€‚

### 2.å›¾ç‰‡æ¼”ç¤º

![1.png](1.png)

![2.png](2.png)

![3.png](3.png)

##### æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ2.å›¾ç‰‡æ¼”ç¤ºâ€å’Œâ€œ3.è§†é¢‘æ¼”ç¤ºâ€å±•ç¤ºçš„ç³»ç»Ÿå›¾ç‰‡æˆ–è€…è§†é¢‘å¯èƒ½ä¸ºè€ç‰ˆæœ¬ï¼Œæ–°ç‰ˆæœ¬åœ¨è€ç‰ˆæœ¬çš„åŸºç¡€ä¸Šå‡çº§å¦‚ä¸‹ï¼šï¼ˆå®é™…æ•ˆæœä»¥å‡çº§çš„æ–°ç‰ˆæœ¬ä¸ºå‡†ï¼‰

  ï¼ˆ1ï¼‰é€‚é…äº†YOLOV8çš„â€œç›®æ ‡æ£€æµ‹â€æ¨¡å‹å’Œâ€œå®ä¾‹åˆ†å‰²â€æ¨¡å‹ï¼Œé€šè¿‡åŠ è½½ç›¸åº”çš„æƒé‡ï¼ˆ.ptï¼‰æ–‡ä»¶å³å¯è‡ªé€‚åº”åŠ è½½æ¨¡å‹ã€‚

  ï¼ˆ2ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«æ¨¡å¼ã€‚

  ï¼ˆ3ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«ç»“æœä¿å­˜å¯¼å‡ºï¼Œè§£å†³æ‰‹åŠ¨å¯¼å‡ºï¼ˆå®¹æ˜“å¡é¡¿å‡ºç°çˆ†å†…å­˜ï¼‰å­˜åœ¨çš„é—®é¢˜ï¼Œè¯†åˆ«å®Œè‡ªåŠ¨ä¿å­˜ç»“æœå¹¶å¯¼å‡ºåˆ°tempDirä¸­ã€‚

  ï¼ˆ4ï¼‰æ”¯æŒWebå‰ç«¯ç³»ç»Ÿä¸­çš„æ ‡é¢˜ã€èƒŒæ™¯å›¾ç­‰è‡ªå®šä¹‰ä¿®æ”¹ï¼Œåé¢æä¾›ä¿®æ”¹æ•™ç¨‹ã€‚

  å¦å¤–æœ¬é¡¹ç›®æä¾›è®­ç»ƒçš„æ•°æ®é›†å’Œè®­ç»ƒæ•™ç¨‹,æš‚ä¸æä¾›æƒé‡æ–‡ä»¶ï¼ˆbest.ptï¼‰,éœ€è¦æ‚¨æŒ‰ç…§æ•™ç¨‹è¿›è¡Œè®­ç»ƒåå®ç°å›¾ç‰‡æ¼”ç¤ºå’ŒWebå‰ç«¯ç•Œé¢æ¼”ç¤ºçš„æ•ˆæœã€‚

### 3.è§†é¢‘æ¼”ç¤º

[3.1 è§†é¢‘æ¼”ç¤º](https://www.bilibili.com/video/BV1AusNezEMi/?vd_source=ff015de2d29cbe2a9cdbfa7064407a08)

### 4.æ•°æ®é›†ä¿¡æ¯å±•ç¤º

æ•°æ®é›†ä¿¡æ¯å±•ç¤º

æœ¬æ•°æ®é›†æ—¨åœ¨ä¸ºæ”¹è¿›YOLOv8çš„äº¤é€šæµé‡ç›‘æµ‹ç³»ç»Ÿæä¾›å¼ºæœ‰åŠ›çš„æ”¯æŒï¼Œä¸“æ³¨äºäº¤é€šå¯†åº¦çš„åˆ†æä¸è¯†åˆ«ã€‚è¯¥æ•°æ®é›†åŒ…å«7354å¹…é«˜è´¨é‡å›¾åƒï¼Œæ¶µç›–äº†å¤šç§äº¤é€šå‚ä¸è€…å’Œè½¦è¾†ç±»å‹ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°å¸®åŠ©ç ”ç©¶äººå‘˜å’Œå¼€å‘è€…åœ¨äº¤é€šæµé‡ç›‘æµ‹é¢†åŸŸè¿›è¡Œæ·±å…¥çš„æ¨¡å‹è®­ç»ƒä¸è¯„ä¼°ã€‚æ•°æ®é›†ä¸­çš„å›¾åƒå‡ç»è¿‡ç²¾å¿ƒæŒ‘é€‰ï¼Œç¡®ä¿å…¶åœ¨ä¸åŒçš„ç¯å¢ƒå’Œæ¡ä»¶ä¸‹éƒ½èƒ½çœŸå®åæ˜ äº¤é€šçŠ¶å†µï¼Œè¿›è€Œæå‡æ¨¡å‹çš„é²æ£’æ€§å’Œå‡†ç¡®æ€§ã€‚

åœ¨ç±»åˆ«æ–¹é¢ï¼Œæœ¬æ•°æ®é›†å…±è®¾å®šäº†8ä¸ªäº¤é€šå‚ä¸è€…ç±»åˆ«ï¼Œåˆ†åˆ«ä¸ºï¼šè‡ªè¡Œè½¦ã€ç”µåŠ¨è‡ªè¡Œè½¦ã€å‰æ™®è½¦ã€æ‘©æ‰˜è½¦ã€è¡Œäººã€ä¸‰è½®è½¦ã€å¡è½¦å’Œè½¦è¾†ã€‚è¿™äº›ç±»åˆ«çš„é€‰æ‹©ä¸ä»…æ¶µç›–äº†åŸå¸‚äº¤é€šä¸­å¸¸è§çš„å„ç§äº¤é€šå·¥å…·ï¼Œè¿˜è€ƒè™‘åˆ°äº†ä¸åŒåœ°åŒºå’Œæ–‡åŒ–èƒŒæ™¯ä¸‹çš„äº¤é€šç‰¹ç‚¹ã€‚ä¾‹å¦‚ï¼Œå‰æ™®è½¦å’Œä¸‰è½®è½¦åœ¨æŸäº›å›½å®¶çš„åŸå¸‚äº¤é€šä¸­æ‰®æ¼”ç€é‡è¦è§’è‰²ï¼Œè€Œç”µåŠ¨è‡ªè¡Œè½¦åˆ™åœ¨ç°ä»£åŸå¸‚ä¸­è¶Šæ¥è¶Šæ™®åŠã€‚é€šè¿‡å¯¹è¿™äº›ç±»åˆ«çš„æ ‡æ³¨ï¼Œæ•°æ®é›†èƒ½å¤Ÿä¸ºYOLOv8æ¨¡å‹æä¾›å¤šæ ·åŒ–çš„è®­ç»ƒæ ·æœ¬ï¼Œä½¿å…¶åœ¨å®é™…åº”ç”¨ä¸­èƒ½å¤Ÿæ›´å¥½åœ°è¯†åˆ«å’Œåˆ†ç±»ä¸åŒç±»å‹çš„äº¤é€šå‚ä¸è€…ã€‚

æ­¤å¤–ï¼Œæ•°æ®é›†çš„æ„å»ºéµå¾ªäº†CC BY 4.0çš„è®¸å¯è¯ï¼Œè¿™æ„å‘³ç€ç”¨æˆ·å¯ä»¥è‡ªç”±åœ°ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘æ•°æ®é›†ï¼Œåªéœ€åœ¨ä½¿ç”¨æ—¶ç»™äºˆé€‚å½“çš„ç½²åã€‚è¿™ç§å¼€æ”¾çš„è®¸å¯è¯æ”¿ç­–ä¸ä»…ä¿ƒè¿›äº†å­¦æœ¯ç•Œå’Œå·¥ä¸šç•Œçš„åˆä½œä¸äº¤æµï¼Œä¹Ÿä¸ºç ”ç©¶äººå‘˜æä¾›äº†æ›´å¤§çš„çµæ´»æ€§ï¼Œä½¿ä»–ä»¬èƒ½å¤Ÿæ ¹æ®è‡ªå·±çš„éœ€æ±‚å¯¹æ•°æ®é›†è¿›è¡ŒäºŒæ¬¡å¼€å‘å’Œåº”ç”¨ã€‚

åœ¨æ•°æ®é›†çš„åº”ç”¨åœºæ™¯æ–¹é¢ï¼Œæ”¹è¿›YOLOv8çš„äº¤é€šæµé‡ç›‘æµ‹ç³»ç»Ÿå¯ä»¥å¹¿æ³›åº”ç”¨äºæ™ºèƒ½äº¤é€šç®¡ç†ã€åŸå¸‚è§„åˆ’ã€äº¤é€šå®‰å…¨ç›‘æµ‹ç­‰å¤šä¸ªé¢†åŸŸã€‚é€šè¿‡å¯¹äº¤é€šå¯†åº¦çš„å®æ—¶ç›‘æµ‹ï¼Œç›¸å…³éƒ¨é—¨å¯ä»¥æ›´å¥½åœ°ç†è§£äº¤é€šæµåŠ¨æƒ…å†µï¼Œä»è€Œåˆ¶å®šå‡ºæ›´ä¸ºç§‘å­¦åˆç†çš„äº¤é€šç®¡ç†ç­–ç•¥ï¼Œæå‡åŸå¸‚äº¤é€šçš„æ•ˆç‡å’Œå®‰å…¨æ€§ã€‚åŒæ—¶ï¼Œç ”ç©¶äººå‘˜ä¹Ÿå¯ä»¥åˆ©ç”¨è¯¥æ•°æ®é›†è¿›è¡Œäº¤é€šè¡Œä¸ºåˆ†æï¼Œæ¢è®¨ä¸åŒäº¤é€šå‚ä¸è€…ä¹‹é—´çš„äº’åŠ¨å…³ç³»ï¼Œä¸ºæœªæ¥çš„äº¤é€šç³»ç»Ÿè®¾è®¡æä¾›æ•°æ®æ”¯æŒã€‚

æ€»ä¹‹ï¼Œæœ¬æ•°æ®é›†ä¸ä»…ä¸ºYOLOv8æ¨¡å‹çš„è®­ç»ƒæä¾›äº†ä¸°å¯Œçš„æ ·æœ¬æ•°æ®ï¼Œä¹Ÿä¸ºäº¤é€šæµé‡ç›‘æµ‹é¢†åŸŸçš„ç ”ç©¶æä¾›äº†é‡è¦çš„åŸºç¡€ã€‚é€šè¿‡å¯¹äº¤é€šå¯†åº¦çš„æ·±å…¥åˆ†æï¼Œç ”ç©¶äººå‘˜å’Œå¼€å‘è€…èƒ½å¤Ÿæ›´å¥½åœ°åº”å¯¹åŸå¸‚äº¤é€šæ—¥ç›Šå¢é•¿çš„æŒ‘æˆ˜ï¼Œæ¨åŠ¨æ™ºèƒ½äº¤é€šç³»ç»Ÿçš„ä¸æ–­å‘å±•ä¸å®Œå–„ã€‚

![4.png](4.png)

![5.png](5.png)

![6.png](6.png)

![7.png](7.png)

![8.png](8.png)

### 5.å…¨å¥—é¡¹ç›®ç¯å¢ƒéƒ¨ç½²è§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰

[5.1 ç¯å¢ƒéƒ¨ç½²æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404473917358506534?logTag=c807d0cbc21c0ef59de5)




[5.2 å®‰è£…Pythonè™šæ‹Ÿç¯å¢ƒåˆ›å»ºå’Œä¾èµ–åº“å®‰è£…è§†é¢‘æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404474678003106304?logTag=1f1041108cd1f708b01a)

### 6.æ‰‹æŠŠæ‰‹YOLOV8è®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰

[6.1 ç¯å¢ƒéƒ¨ç½²æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404477157818401292?logTag=d31a2dfd1983c9668658)

### 7.70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹ä»£ç åŠ è½½è°ƒå‚è§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰

[7.1 ç¯å¢ƒéƒ¨ç½²æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404478314661806627?logTag=29066f8288e3f4eea3a4)

### 8.70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹åŸç†è®²è§£ï¼ˆéç§‘ç­ä¹Ÿå¯ä»¥è½»æ¾å†™åˆŠå‘åˆŠï¼ŒV10ç‰ˆæœ¬æ­£åœ¨ç§‘ç ”å¾…æ›´æ–°ï¼‰

ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæ¯ä¸ªåˆ›æ–°ç‚¹çš„å…·ä½“åŸç†è®²è§£å°±ä¸ä¸€ä¸€å±•å¼€ï¼Œå…·ä½“è§ä¸‹åˆ—ç½‘å€ä¸­çš„åˆ›æ–°ç‚¹å¯¹åº”å­é¡¹ç›®çš„æŠ€æœ¯åŸç†åšå®¢ç½‘å€ã€Blogã€‘ï¼š

![9.png](9.png)

[8.1 70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹åŸç†è®²è§£é“¾æ¥](https://gitee.com/qunmasj/good)

### 9.ç³»ç»ŸåŠŸèƒ½å±•ç¤ºï¼ˆæ£€æµ‹å¯¹è±¡ä¸ºä¸¾ä¾‹ï¼Œå®é™…å†…å®¹ä»¥æœ¬é¡¹ç›®æ•°æ®é›†ä¸ºå‡†ï¼‰

å›¾9.1.ç³»ç»Ÿæ”¯æŒæ£€æµ‹ç»“æœè¡¨æ ¼æ˜¾ç¤º

  å›¾9.2.ç³»ç»Ÿæ”¯æŒç½®ä¿¡åº¦å’ŒIOUé˜ˆå€¼æ‰‹åŠ¨è°ƒèŠ‚

  å›¾9.3.ç³»ç»Ÿæ”¯æŒè‡ªå®šä¹‰åŠ è½½æƒé‡æ–‡ä»¶best.pt(éœ€è¦ä½ é€šè¿‡æ­¥éª¤5ä¸­è®­ç»ƒè·å¾—)

  å›¾9.4.ç³»ç»Ÿæ”¯æŒæ‘„åƒå¤´å®æ—¶è¯†åˆ«

  å›¾9.5.ç³»ç»Ÿæ”¯æŒå›¾ç‰‡è¯†åˆ«

  å›¾9.6.ç³»ç»Ÿæ”¯æŒè§†é¢‘è¯†åˆ«

  å›¾9.7.ç³»ç»Ÿæ”¯æŒè¯†åˆ«ç»“æœæ–‡ä»¶è‡ªåŠ¨ä¿å­˜

  å›¾9.8.ç³»ç»Ÿæ”¯æŒExcelå¯¼å‡ºæ£€æµ‹ç»“æœæ•°æ®

![10.png](10.png)

![11.png](11.png)

![12.png](12.png)

![13.png](13.png)

![14.png](14.png)

![15.png](15.png)

![16.png](16.png)

![17.png](17.png)

### 10.åŸå§‹YOLOV8ç®—æ³•åŸç†

åŸå§‹YOLOv8ç®—æ³•åŸç†

YOLOï¼ˆYou Only Look Onceï¼‰ç³»åˆ—ç®—æ³•è‡ªå…¶è¯ç”Ÿä»¥æ¥ï¼Œä¾¿åœ¨ç›®æ ‡æ£€æµ‹é¢†åŸŸå¼•é¢†äº†æ–°çš„æ½®æµã€‚YOLOv8ä½œä¸ºè¯¥ç³»åˆ—çš„æœ€æ–°ç‰ˆæœ¬ï¼Œæ‰¿è½½ç€å‰è¾ˆä»¬çš„åˆ›æ–°ä¸å‘å±•ï¼Œç»“åˆäº†æ·±åº¦å­¦ä¹ çš„æœ€æ–°è¿›å±•ï¼Œå±•ç°å‡ºæ›´é«˜çš„æ£€æµ‹ç²¾åº¦å’Œæ›´å¿«çš„å¤„ç†é€Ÿåº¦ã€‚YOLOv8çš„è®¾è®¡ç†å¿µä¾ç„¶åŸºäºå°†ç›®æ ‡æ£€æµ‹ä»»åŠ¡è½¬åŒ–ä¸ºå›å½’é—®é¢˜çš„æ¡†æ¶ï¼Œé€šè¿‡ä¸€ä¸ªå•ä¸€çš„ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œç›´æ¥é¢„æµ‹ç›®æ ‡çš„ä½ç½®å’Œç±»åˆ«ï¼Œä»è€Œå®ç°é«˜æ•ˆçš„å®æ—¶æ£€æµ‹ã€‚

YOLOv8çš„ç½‘ç»œç»“æ„ä¸»è¦ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šä¸»å¹²ç½‘ç»œï¼ˆBackboneï¼‰ã€ç‰¹å¾å¢å¼ºç½‘ç»œï¼ˆNeckï¼‰å’Œæ£€æµ‹å¤´ï¼ˆHeadï¼‰ã€‚åœ¨ä¸»å¹²ç½‘ç»œæ–¹é¢ï¼ŒYOLOv8å»¶ç»­äº†CSPï¼ˆCross Stage Partialï¼‰ç½‘ç»œçš„æ€æƒ³ï¼Œé€šè¿‡åˆ†æ®µè¿æ¥çš„æ–¹å¼ï¼Œå‡å°‘äº†è®¡ç®—é‡çš„åŒæ—¶ä¿æŒäº†ç‰¹å¾çš„ä¸°å¯Œæ€§ã€‚CSPç»“æ„çš„å¼•å…¥ï¼Œä½¿å¾—ç½‘ç»œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­èƒ½å¤Ÿæ›´å¥½åœ°ä¼ é€’æ¢¯åº¦ä¿¡æ¯ï¼Œè¿›è€Œæé«˜æ¨¡å‹çš„å­¦ä¹ èƒ½åŠ›å’Œæ³›åŒ–èƒ½åŠ›ã€‚

ç‰¹å¾å¢å¼ºç½‘ç»œéƒ¨åˆ†ï¼ŒYOLOv8é‡‡ç”¨äº†PAN-FPNï¼ˆPath Aggregation Network - Feature Pyramid Networkï¼‰çš„è®¾è®¡ç†å¿µã€‚è¿™ä¸€ç»“æ„é€šè¿‡ä¸Šä¸‹é‡‡æ ·å’Œç‰¹å¾æ‹¼æ¥çš„æ–¹å¼ï¼Œèåˆäº†ä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾ï¼Œç¡®ä¿äº†ç½‘ç»œåœ¨å¤„ç†å¤šå°ºåº¦ç›®æ ‡æ—¶çš„çµæ´»æ€§å’Œå‡†ç¡®æ€§ã€‚ä¸ä¹‹å‰çš„YOLOç‰ˆæœ¬ç›¸æ¯”ï¼ŒYOLOv8åœ¨ç‰¹å¾èåˆä¸Šè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå»é™¤äº†ä¸Šé‡‡æ ·éƒ¨åˆ†çš„å·ç§¯ç»“æ„ï¼Œç®€åŒ–äº†ç½‘ç»œçš„å¤æ‚åº¦ï¼ŒåŒæ—¶æå‡äº†ç‰¹å¾çš„è¡¨è¾¾èƒ½åŠ›ã€‚

åœ¨æ£€æµ‹å¤´éƒ¨åˆ†ï¼ŒYOLOv8å¼•å…¥äº†æ–°çš„è§£è€¦å¤´ç»“æ„ï¼Œå°†åˆ†ç±»å’Œå›å½’ä»»åŠ¡åˆ†ç¦»ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„åˆ†æ”¯ã€‚è¿™ä¸€åˆ›æ–°ä½¿å¾—æ¯ä¸ªä»»åŠ¡å¯ä»¥æ›´åŠ ä¸“æ³¨äºè‡ªèº«çš„ç›®æ ‡ï¼Œè§£å†³äº†å¤æ‚åœºæ™¯ä¸‹å¯èƒ½å‡ºç°çš„å®šä½ä¸å‡†å’Œåˆ†ç±»é”™è¯¯çš„é—®é¢˜ã€‚ä¼ ç»Ÿçš„è€¦åˆå¤´ç»“æ„å¾€å¾€ä¼šå¯¼è‡´ä»»åŠ¡ä¹‹é—´çš„å¹²æ‰°ï¼Œè€Œè§£è€¦åˆçš„è®¾è®¡æœ‰æ•ˆåœ°æé«˜äº†æ¨¡å‹çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤æ‚èƒŒæ™¯å’Œå°ç›®æ ‡æ—¶çš„è¡¨ç°ã€‚

YOLOv8çš„å¦ä¸€ä¸ªæ˜¾è‘—åˆ›æ–°æ˜¯é‡‡ç”¨äº†Anchor-freeç›®æ ‡æ£€æµ‹æ–¹æ³•ã€‚è¿™ä¸€æ–¹æ³•æ‘’å¼ƒäº†ä¼ ç»Ÿçš„Anchor-basedç­–ç•¥ï¼Œç›´æ¥é€šè¿‡å›å½’çš„æ–¹å¼é¢„æµ‹ç›®æ ‡çš„ä½ç½®å’Œå¤§å°ã€‚ä¼ ç»Ÿæ–¹æ³•ä¸­ï¼Œé”šç‚¹æ¡†çš„é€‰æ‹©å’Œè°ƒæ•´å¾€å¾€éœ€è¦è€—è´¹å¤§é‡çš„æ—¶é—´å’Œç²¾åŠ›ï¼Œä¸”å¯¹äºä¸åŒå°ºåº¦å’Œå½¢çŠ¶çš„ç›®æ ‡ï¼Œå¯èƒ½éœ€è¦è®¾è®¡ä¸åŒçš„é”šç‚¹æ¡†ã€‚è€ŒYOLOv8çš„Anchor-freeè®¾è®¡ä½¿å¾—ç½‘ç»œèƒ½å¤Ÿæ›´å¿«åœ°èšç„¦äºç›®æ ‡ä½ç½®çš„é‚»è¿‘ç‚¹ï¼Œä»è€Œä½¿å¾—é¢„æµ‹æ¡†æ›´æ¥è¿‘äºå®é™…çš„è¾¹ç•Œæ¡†åŒºåŸŸã€‚è¿™ä¸€è½¬å˜ä¸ä»…æé«˜äº†æ£€æµ‹ç²¾åº¦ï¼Œä¹Ÿç®€åŒ–äº†æ¨¡å‹çš„è®¾è®¡å’Œè®­ç»ƒè¿‡ç¨‹ã€‚

åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼ŒYOLOv8å¼•å…¥äº†å¤šç§æ•°æ®å¢å¼ºæŠ€æœ¯ï¼Œå¦‚Mosaicæ•°æ®å¢å¼ºã€è‡ªé€‚åº”å›¾ç‰‡ç¼©æ”¾å’Œç°åº¦å¡«å……ç­‰ï¼Œè¿›ä¸€æ­¥æå‡äº†æ¨¡å‹çš„é²æ£’æ€§ã€‚æ­¤å¤–ï¼ŒYOLOv8åœ¨æŸå¤±è®¡ç®—æ–¹é¢ä¹Ÿè¿›è¡Œäº†åˆ›æ–°ï¼Œé‡‡ç”¨äº†BCELossä½œä¸ºåˆ†ç±»æŸå¤±ï¼ŒDFLLosså’ŒCIoULossä½œä¸ºå›å½’æŸå¤±ã€‚è¿™äº›æ”¹è¿›ä½¿å¾—æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­èƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”ä¸åŒçš„ä»»åŠ¡éœ€æ±‚ï¼Œæé«˜äº†æ•´ä½“çš„æ£€æµ‹æ€§èƒ½ã€‚

YOLOv8è¿˜æ ¹æ®ä¸åŒåœºæ™¯çš„éœ€æ±‚ï¼Œæä¾›äº†å¤šç§å°ºåº¦çš„æ¨¡å‹ï¼ŒåŒ…æ‹¬nã€sã€mã€lã€xäº”ç§ä¸åŒçš„ç‰ˆæœ¬ã€‚è¿™äº›æ¨¡å‹åœ¨è®¾è®¡æ—¶å¹¶ä¸æ˜¯ç®€å•åœ°éµå¾ªä¸€å¥—ç¼©æ”¾ç³»æ•°ï¼Œè€Œæ˜¯æ ¹æ®ä¸»å¹²ç½‘ç»œçš„é€šé“æ•°è¿›è¡Œè°ƒæ•´ï¼Œä»¥è¾¾åˆ°æœ€ä½³çš„æ€§èƒ½è¡¨ç°ã€‚è¿™ç§çµæ´»çš„è®¾è®¡ä½¿å¾—YOLOv8èƒ½å¤Ÿé€‚åº”å„ç§åº”ç”¨åœºæ™¯ï¼Œä»åµŒå…¥å¼è®¾å¤‡åˆ°é«˜æ€§èƒ½è®¡ç®—å¹³å°ï¼Œå‡èƒ½å‘æŒ¥å‡ºè‰²çš„æ€§èƒ½ã€‚

å°½ç®¡YOLOv8åœ¨è®¸å¤šæ–¹é¢éƒ½å–å¾—äº†æ˜¾è‘—çš„è¿›æ­¥ï¼Œä½†åœ¨æŸäº›å¤æ‚ç¯å¢ƒä¸‹ï¼Œä»ç„¶å­˜åœ¨ä¸€äº›æŒ‘æˆ˜ã€‚ä¾‹å¦‚ï¼Œåœ¨æ°´é¢ç­‰å¤æ‚èƒŒæ™¯ä¸‹ï¼Œå°ç›®æ ‡çš„æ£€æµ‹ä»ç„¶é¢ä¸´å®šä½è¯¯å·®å’Œå¯¹ç›®æ ‡æ„ŸçŸ¥èƒ½åŠ›ä¸è¶³çš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œç ”ç©¶è€…ä»¬æå‡ºäº†YOLOv8-WSSODç®—æ³•ï¼Œé€šè¿‡å¼•å…¥åŒå±‚è·¯ç”±æ³¨æ„åŠ›æœºåˆ¶å’Œæ”¹è¿›çš„æ£€æµ‹å¤´ï¼Œè¿›ä¸€æ­¥æå‡äº†æ¨¡å‹å¯¹å°ç›®æ ‡çš„æ„ŸçŸ¥èƒ½åŠ›å’Œå®šä½ç²¾åº¦ã€‚

æ€»çš„æ¥è¯´ï¼ŒYOLOv8ç®—æ³•åœ¨YOLOç³»åˆ—ä¸­ä»£è¡¨äº†ä¸€ä¸ªé‡è¦çš„é‡Œç¨‹ç¢‘ã€‚å®ƒä¸ä»…ç»§æ‰¿äº†å‰å‡ ä»£ç®—æ³•çš„ä¼˜ç‚¹ï¼Œè¿˜åœ¨ç½‘ç»œç»“æ„ã€æŸå¤±è®¡ç®—å’Œç›®æ ‡æ£€æµ‹æ–¹æ³•ç­‰å¤šä¸ªæ–¹é¢è¿›è¡Œäº†åˆ›æ–°ã€‚éšç€æ·±åº¦å­¦ä¹ æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼ŒYOLOv8æ— ç–‘å°†åœ¨ç›®æ ‡æ£€æµ‹é¢†åŸŸç»§ç»­å‘æŒ¥é‡è¦ä½œç”¨ï¼Œæ¨åŠ¨ç›¸å…³åº”ç”¨çš„è¿›ä¸€æ­¥å‘å±•ã€‚é€šè¿‡ä¸æ–­çš„ä¼˜åŒ–å’Œæ”¹è¿›ï¼ŒYOLOv8å°†èƒ½å¤Ÿåœ¨æ›´å¹¿æ³›çš„åœºæ™¯ä¸­å®ç°é«˜æ•ˆã€å‡†ç¡®çš„ç›®æ ‡æ£€æµ‹ï¼Œä¸ºå®é™…åº”ç”¨æä¾›å¼ºæœ‰åŠ›çš„æ”¯æŒã€‚

![18.png](18.png)

### 11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰

#### 11.1 ultralytics\models\rtdetr\model.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç²¾ç®€å’Œæ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼š

```python
# Ultralytics YOLO ğŸš€, AGPL-3.0 license
"""
RT-DETRæ¥å£ï¼ŒåŸºäºè§†è§‰å˜æ¢å™¨çš„å®æ—¶ç›®æ ‡æ£€æµ‹å™¨ï¼Œæä¾›é«˜æ•ˆçš„æ£€æµ‹æ€§èƒ½å’Œå‡†ç¡®æ€§ã€‚
"""

from ultralytics.engine.model import Model  # å¯¼å…¥åŸºç¡€æ¨¡å‹ç±»
from ultralytics.nn.tasks import RTDETRDetectionModel  # å¯¼å…¥RT-DETRæ£€æµ‹æ¨¡å‹

from .predict import RTDETRPredictor  # å¯¼å…¥é¢„æµ‹å™¨
from .train import RTDETRTrainer  # å¯¼å…¥è®­ç»ƒå™¨
from .val import RTDETRValidator  # å¯¼å…¥éªŒè¯å™¨


class RTDETR(Model):
    """
    RT-DETRæ¨¡å‹æ¥å£ï¼ŒåŸºäºè§†è§‰å˜æ¢å™¨çš„ç›®æ ‡æ£€æµ‹å™¨ï¼Œæä¾›å®æ—¶æ€§èƒ½å’Œé«˜å‡†ç¡®æ€§ã€‚
    
    å±æ€§:
        model (str): é¢„è®­ç»ƒæ¨¡å‹çš„è·¯å¾„ï¼Œé»˜è®¤ä¸º'rtdetr-l.pt'ã€‚
    """

    def __init__(self, model="rtdetr-l.pt") -> None:
        """
        åˆå§‹åŒ–RT-DETRæ¨¡å‹ï¼ŒåŠ è½½ç»™å®šçš„é¢„è®­ç»ƒæ¨¡å‹æ–‡ä»¶ï¼Œæ”¯æŒ.ptå’Œ.yamlæ ¼å¼ã€‚

        å‚æ•°:
            model (str): é¢„è®­ç»ƒæ¨¡å‹çš„è·¯å¾„ï¼Œé»˜è®¤ä¸º'rtdetr-l.pt'ã€‚

        å¼‚å¸¸:
            NotImplementedError: å¦‚æœæ¨¡å‹æ–‡ä»¶æ‰©å±•åä¸æ˜¯'pt'ã€'yaml'æˆ–'yml'ã€‚
        """
        # æ£€æŸ¥æ¨¡å‹æ–‡ä»¶æ‰©å±•åæ˜¯å¦æœ‰æ•ˆ
        if model and model.split(".")[-1] not in ("pt", "yaml", "yml"):
            raise NotImplementedError("RT-DETRåªæ”¯æŒä»*.ptã€*.yamlæˆ–*.ymlæ–‡ä»¶åˆ›å»ºã€‚")
        super().__init__(model=model, task="detect")  # è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°

    @property
    def task_map(self) -> dict:
        """
        è¿”å›RT-DETRçš„ä»»åŠ¡æ˜ å°„ï¼Œå°†ä»»åŠ¡ä¸ç›¸åº”çš„Ultralyticsç±»å…³è”ã€‚

        è¿”å›:
            dict: å°†ä»»åŠ¡åç§°æ˜ å°„åˆ°RT-DETRæ¨¡å‹çš„Ultralyticsä»»åŠ¡ç±»çš„å­—å…¸ã€‚
        """
        return {
            "detect": {
                "predictor": RTDETRPredictor,  # é¢„æµ‹å™¨ç±»
                "validator": RTDETRValidator,  # éªŒè¯å™¨ç±»
                "trainer": RTDETRTrainer,  # è®­ç»ƒå™¨ç±»
                "model": RTDETRDetectionModel,  # æ£€æµ‹æ¨¡å‹ç±»
            }
        }
```

### ä»£ç åˆ†æï¼š
1. **å¯¼å…¥éƒ¨åˆ†**ï¼šå¯¼å…¥äº†æ‰€éœ€çš„æ¨¡å—å’Œç±»ï¼ŒåŒ…æ‹¬åŸºç¡€æ¨¡å‹ç±»å’ŒRT-DETRç›¸å…³çš„é¢„æµ‹ã€è®­ç»ƒå’ŒéªŒè¯ç±»ã€‚
  
2. **RTDETRç±»**ï¼šç»§æ‰¿è‡ª`Model`ç±»ï¼Œè¡¨ç¤ºRT-DETRæ¨¡å‹çš„æ¥å£ï¼Œæä¾›äº†åˆå§‹åŒ–å’Œä»»åŠ¡æ˜ å°„çš„åŠŸèƒ½ã€‚

3. **åˆå§‹åŒ–æ–¹æ³•**ï¼š
   - æ£€æŸ¥ä¼ å…¥çš„æ¨¡å‹æ–‡ä»¶ååç¼€æ˜¯å¦æœ‰æ•ˆï¼ˆä»…æ”¯æŒ`.pt`ã€`.yaml`å’Œ`.yml`ï¼‰ã€‚
   - è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œè®¾ç½®æ¨¡å‹å’Œä»»åŠ¡ç±»å‹ã€‚

4. **ä»»åŠ¡æ˜ å°„å±æ€§**ï¼šå®šä¹‰äº†ä¸€ä¸ªå­—å…¸ï¼Œå°†ä¸åŒçš„ä»»åŠ¡ï¼ˆå¦‚é¢„æµ‹ã€éªŒè¯å’Œè®­ç»ƒï¼‰æ˜ å°„åˆ°ç›¸åº”çš„ç±»ï¼Œä¾¿äºåç»­è°ƒç”¨ã€‚

é€šè¿‡è¿™äº›æ ¸å¿ƒéƒ¨åˆ†å’Œæ³¨é‡Šï¼Œå¯ä»¥æ›´å¥½åœ°ç†è§£RT-DETRæ¨¡å‹çš„ç»“æ„å’ŒåŠŸèƒ½ã€‚

è¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ªå…³äºç™¾åº¦çš„RT-DETRæ¨¡å‹çš„æ¥å£å®ç°ï¼ŒRT-DETRæ˜¯ä¸€ç§åŸºäºè§†è§‰å˜æ¢å™¨ï¼ˆVision Transformerï¼‰çš„å®æ—¶ç›®æ ‡æ£€æµ‹å™¨ã€‚è¯¥æ¨¡å‹æ—¨åœ¨æä¾›å®æ—¶æ€§èƒ½å’Œé«˜å‡†ç¡®æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨CUDAå’ŒTensorRTç­‰åŠ é€Ÿåç«¯æ—¶è¡¨ç°å‡ºè‰²ã€‚RT-DETRå…·æœ‰é«˜æ•ˆçš„æ··åˆç¼–ç å™¨å’ŒIoUï¼ˆIntersection over Unionï¼‰æ„ŸçŸ¥æŸ¥è¯¢é€‰æ‹©åŠŸèƒ½ï¼Œä»¥æé«˜æ£€æµ‹ç²¾åº¦ã€‚

æ–‡ä»¶ä¸­é¦–å…ˆå¯¼å…¥äº†å¿…è¦çš„æ¨¡å—ï¼ŒåŒ…æ‹¬Ultralyticsåº“ä¸­çš„Modelç±»å’ŒRTDETRDetectionModelç±»ï¼Œä»¥åŠç”¨äºé¢„æµ‹ã€è®­ç»ƒå’ŒéªŒè¯çš„ç›¸å…³æ¨¡å—ã€‚æ¥ç€å®šä¹‰äº†RTDETRç±»ï¼Œè¯¥ç±»ç»§æ‰¿è‡ªModelç±»ï¼Œæ„æˆäº†RT-DETRæ¨¡å‹çš„æ ¸å¿ƒæ¥å£ã€‚

åœ¨RTDETRç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œæ¥å—ä¸€ä¸ªåä¸ºmodelçš„å‚æ•°ï¼Œé»˜è®¤å€¼ä¸ºâ€œrtdetr-l.ptâ€ã€‚è¯¥å‚æ•°æŒ‡å®šäº†é¢„è®­ç»ƒæ¨¡å‹çš„è·¯å¾„ã€‚æ„é€ å‡½æ•°ä¸­æœ‰ä¸€ä¸ªæ£€æŸ¥ï¼Œç¡®ä¿ä¼ å…¥çš„æ¨¡å‹æ–‡ä»¶æ‰©å±•åä¸ºâ€œptâ€ã€â€œyamlâ€æˆ–â€œymlâ€ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™æŠ›å‡ºNotImplementedErrorå¼‚å¸¸ï¼Œæç¤ºç”¨æˆ·åªæ”¯æŒè¿™å‡ ç§æ ¼å¼ã€‚

æ­¤å¤–ï¼ŒRTDETRç±»è¿˜å®šä¹‰äº†ä¸€ä¸ªåä¸ºtask_mapçš„å±æ€§ï¼Œå®ƒè¿”å›ä¸€ä¸ªå­—å…¸ï¼Œæ˜ å°„äº†ä¸RT-DETRç›¸å…³çš„ä»»åŠ¡åŠå…¶å¯¹åº”çš„Ultralyticsç±»ã€‚è¿™äº›ä»»åŠ¡åŒ…æ‹¬é¢„æµ‹ï¼ˆpredictorï¼‰ã€éªŒè¯ï¼ˆvalidatorï¼‰ã€è®­ç»ƒï¼ˆtrainerï¼‰å’Œæ¨¡å‹ï¼ˆmodelï¼‰ï¼Œåˆ†åˆ«å¯¹åº”RTDETRPredictorã€RTDETRValidatorã€RTDETRTrainerå’ŒRTDETRDetectionModelç±»ã€‚

æ€»ä½“è€Œè¨€ï¼Œè¯¥æ–‡ä»¶æä¾›äº†RT-DETRæ¨¡å‹çš„åŸºæœ¬æ¡†æ¶ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡æŒ‡å®šé¢„è®­ç»ƒæ¨¡å‹æ–‡ä»¶æ¥åˆå§‹åŒ–æ¨¡å‹ï¼Œå¹¶ä¸ºä¸åŒçš„ä»»åŠ¡æä¾›äº†ç›¸åº”çš„å¤„ç†ç±»ã€‚

#### 11.2 ui.py

```python
import sys
import subprocess

def run_script(script_path):
    """
    ä½¿ç”¨å½“å‰ Python ç¯å¢ƒè¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚

    Args:
        script_path (str): è¦è¿è¡Œçš„è„šæœ¬è·¯å¾„

    Returns:
        None
    """
    # è·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„
    python_path = sys.executable

    # æ„å»ºè¿è¡Œå‘½ä»¤
    command = f'"{python_path}" -m streamlit run "{script_path}"'

    # æ‰§è¡Œå‘½ä»¤
    result = subprocess.run(command, shell=True)
    if result.returncode != 0:
        print("è„šæœ¬è¿è¡Œå‡ºé”™ã€‚")


# å®ä¾‹åŒ–å¹¶è¿è¡Œåº”ç”¨
if __name__ == "__main__":
    # æŒ‡å®šæ‚¨çš„è„šæœ¬è·¯å¾„
    script_path = "web.py"  # è¿™é‡Œå¯ä»¥ç›´æ¥æŒ‡å®šè„šæœ¬è·¯å¾„

    # è¿è¡Œè„šæœ¬
    run_script(script_path)
```

### ä»£ç æ³¨é‡Šè¯´æ˜ï¼š

1. **å¯¼å…¥æ¨¡å—**ï¼š
   - `import sys`ï¼šå¯¼å…¥ sys æ¨¡å—ï¼Œç”¨äºè®¿é—®ä¸ Python è§£é‡Šå™¨ç›¸å…³çš„å˜é‡å’Œå‡½æ•°ã€‚
   - `import subprocess`ï¼šå¯¼å…¥ subprocess æ¨¡å—ï¼Œç”¨äºæ‰§è¡Œå¤–éƒ¨å‘½ä»¤ã€‚

2. **å®šä¹‰å‡½æ•° `run_script`**ï¼š
   - è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•° `script_path`ï¼Œè¡¨ç¤ºè¦è¿è¡Œçš„ Python è„šæœ¬çš„è·¯å¾„ã€‚
   - å‡½æ•°å†…éƒ¨é¦–å…ˆè·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„ï¼Œä»¥ä¾¿åç»­è°ƒç”¨ã€‚

3. **æ„å»ºå‘½ä»¤**ï¼š
   - ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ„å»ºå‘½ä»¤ï¼Œè°ƒç”¨ `streamlit` è¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚

4. **æ‰§è¡Œå‘½ä»¤**ï¼š
   - ä½¿ç”¨ `subprocess.run` æ‰§è¡Œæ„å»ºçš„å‘½ä»¤ï¼Œå¹¶å°† `shell` å‚æ•°è®¾ç½®ä¸º `True`ï¼Œå…è®¸åœ¨ shell ä¸­æ‰§è¡Œå‘½ä»¤ã€‚
   - æ£€æŸ¥å‘½ä»¤çš„è¿”å›ç ï¼Œå¦‚æœä¸ä¸º 0ï¼Œè¡¨ç¤ºæ‰§è¡Œå‡ºé”™ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯ã€‚

5. **ä¸»ç¨‹åºå…¥å£**ï¼š
   - ä½¿ç”¨ `if __name__ == "__main__":` ç¡®ä¿è¯¥éƒ¨åˆ†ä»£ç ä»…åœ¨è„šæœ¬ç›´æ¥è¿è¡Œæ—¶æ‰§è¡Œã€‚
   - æŒ‡å®šè¦è¿è¡Œçš„è„šæœ¬è·¯å¾„ï¼ˆè¿™é‡Œç›´æ¥æŒ‡å®šä¸º `"web.py"`ï¼‰ã€‚
   - è°ƒç”¨ `run_script` å‡½æ•°è¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶åä¸º `ui.py`ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ä½¿ç”¨å½“å‰çš„ Python ç¯å¢ƒæ¥è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„è„šæœ¬ï¼Œå…·ä½“æ˜¯ä¸€ä¸ªåä¸º `web.py` çš„æ–‡ä»¶ã€‚ç¨‹åºé¦–å…ˆå¯¼å…¥äº†å¿…è¦çš„æ¨¡å—ï¼ŒåŒ…æ‹¬ `sys`ã€`os` å’Œ `subprocess`ï¼Œä»¥åŠä¸€ä¸ªè‡ªå®šä¹‰çš„ `abs_path` å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥è‡ªäº `QtFusion.path` æ¨¡å—ï¼Œå¯èƒ½ç”¨äºè·å–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚

åœ¨ `run_script` å‡½æ•°ä¸­ï¼Œé¦–å…ˆè·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„ï¼Œè¿™é€šè¿‡ `sys.executable` å®ç°ã€‚æ¥ç€ï¼Œæ„å»ºä¸€ä¸ªå‘½ä»¤å­—ç¬¦ä¸²ï¼Œè¯¥å‘½ä»¤ä½¿ç”¨ `streamlit` æ¥è¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚`streamlit` æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºæ•°æ®åº”ç”¨çš„æ¡†æ¶ï¼Œå‘½ä»¤çš„æ ¼å¼ä¸º `python -m streamlit run "script_path"`ã€‚

ç„¶åï¼Œä½¿ç”¨ `subprocess.run` æ–¹æ³•æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œ`shell=True` å‚æ•°å…è®¸åœ¨ shell ä¸­æ‰§è¡Œå‘½ä»¤ã€‚æ‰§è¡Œåï¼Œç¨‹åºæ£€æŸ¥è¿”å›ç ï¼Œå¦‚æœè¿”å›ç ä¸ä¸º 0ï¼Œè¡¨ç¤ºè„šæœ¬è¿è¡Œå‡ºé”™ï¼Œç¨‹åºä¼šæ‰“å°å‡ºç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚

åœ¨æ–‡ä»¶çš„æœ€åéƒ¨åˆ†ï¼Œä½¿ç”¨ `if __name__ == "__main__":` æ¥ç¡®ä¿åªæœ‰åœ¨ç›´æ¥è¿è¡Œè¯¥è„šæœ¬æ—¶æ‰ä¼šæ‰§è¡Œåé¢çš„ä»£ç ã€‚æ­¤æ—¶ï¼Œç¨‹åºæŒ‡å®šäº†è¦è¿è¡Œçš„è„šæœ¬è·¯å¾„ï¼Œå³é€šè¿‡ `abs_path` å‡½æ•°è·å–çš„ `web.py` çš„ç»å¯¹è·¯å¾„ï¼Œå¹¶è°ƒç”¨ `run_script` å‡½æ•°æ¥æ‰§è¡Œè¿™ä¸ªè„šæœ¬ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¿™ä¸ªç¨‹åºçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ä¸º `web.py` æä¾›ä¸€ä¸ªç®€å•çš„è¿è¡Œæ¥å£ï¼Œåˆ©ç”¨å½“å‰ Python ç¯å¢ƒæ¥å¯åŠ¨ Streamlit åº”ç”¨ã€‚

#### 11.3 ultralytics\nn\modules\conv.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import math
import torch
import torch.nn as nn

def autopad(k, p=None, d=1):  # kernel, padding, dilation
    """è‡ªåŠ¨å¡«å……ä»¥ä¿æŒè¾“å‡ºå½¢çŠ¶ä¸å˜ã€‚"""
    if d > 1:
        # å¦‚æœæœ‰è†¨èƒ€(dilation)ï¼Œè®¡ç®—å®é™…çš„å·ç§¯æ ¸å¤§å°
        k = d * (k - 1) + 1 if isinstance(k, int) else [d * (x - 1) + 1 for x in k]
    if p is None:
        # å¦‚æœæ²¡æœ‰æŒ‡å®šå¡«å……ï¼Œè‡ªåŠ¨è®¡ç®—å¡«å……
        p = k // 2 if isinstance(k, int) else [x // 2 for x in k]
    return p

class Conv(nn.Module):
    """æ ‡å‡†å·ç§¯å±‚ï¼ŒåŒ…å«è¾“å…¥é€šé“ã€è¾“å‡ºé€šé“ã€å·ç§¯æ ¸å¤§å°ã€æ­¥å¹…ã€å¡«å……ã€åˆ†ç»„ã€è†¨èƒ€å’Œæ¿€æ´»å‡½æ•°çš„å‚æ•°ã€‚"""

    default_act = nn.SiLU()  # é»˜è®¤æ¿€æ´»å‡½æ•°

    def __init__(self, c1, c2, k=1, s=1, p=None, g=1, d=1, act=True):
        """åˆå§‹åŒ–å·ç§¯å±‚ï¼ŒåŒ…å«æ¿€æ´»å‡½æ•°çš„å‚æ•°ã€‚"""
        super().__init__()
        # åˆ›å»ºå·ç§¯å±‚
        self.conv = nn.Conv2d(c1, c2, k, s, autopad(k, p, d), groups=g, dilation=d, bias=False)
        # æ‰¹å½’ä¸€åŒ–å±‚
        self.bn = nn.BatchNorm2d(c2)
        # è®¾ç½®æ¿€æ´»å‡½æ•°
        self.act = self.default_act if act is True else act if isinstance(act, nn.Module) else nn.Identity()

    def forward(self, x):
        """å¯¹è¾“å…¥å¼ é‡åº”ç”¨å·ç§¯ã€æ‰¹å½’ä¸€åŒ–å’Œæ¿€æ´»å‡½æ•°ã€‚"""
        return self.act(self.bn(self.conv(x)))

class DWConv(Conv):
    """æ·±åº¦å·ç§¯å±‚ï¼Œé€‚ç”¨äºæ¯ä¸ªè¾“å…¥é€šé“å•ç‹¬è¿›è¡Œå·ç§¯ã€‚"""

    def __init__(self, c1, c2, k=1, s=1, d=1, act=True):
        """åˆå§‹åŒ–æ·±åº¦å·ç§¯å±‚ï¼ŒåŒ…å«å‚æ•°ã€‚"""
        super().__init__(c1, c2, k, s, g=math.gcd(c1, c2), d=d, act=act)

class ConvTranspose(nn.Module):
    """è½¬ç½®å·ç§¯å±‚ã€‚"""

    default_act = nn.SiLU()  # é»˜è®¤æ¿€æ´»å‡½æ•°

    def __init__(self, c1, c2, k=2, s=2, p=0, bn=True, act=True):
        """åˆå§‹åŒ–è½¬ç½®å·ç§¯å±‚ï¼ŒåŒ…å«æ‰¹å½’ä¸€åŒ–å’Œæ¿€æ´»å‡½æ•°ã€‚"""
        super().__init__()
        self.conv_transpose = nn.ConvTranspose2d(c1, c2, k, s, p, bias=not bn)
        self.bn = nn.BatchNorm2d(c2) if bn else nn.Identity()
        self.act = self.default_act if act is True else act if isinstance(act, nn.Module) else nn.Identity()

    def forward(self, x):
        """å¯¹è¾“å…¥åº”ç”¨è½¬ç½®å·ç§¯ã€æ‰¹å½’ä¸€åŒ–å’Œæ¿€æ´»å‡½æ•°ã€‚"""
        return self.act(self.bn(self.conv_transpose(x)))

class ChannelAttention(nn.Module):
    """é€šé“æ³¨æ„åŠ›æ¨¡å—ã€‚"""

    def __init__(self, channels: int) -> None:
        """åˆå§‹åŒ–é€šé“æ³¨æ„åŠ›æ¨¡å—ã€‚"""
        super().__init__()
        self.pool = nn.AdaptiveAvgPool2d(1)  # è‡ªé€‚åº”å¹³å‡æ± åŒ–
        self.fc = nn.Conv2d(channels, channels, 1, 1, 0, bias=True)  # 1x1å·ç§¯
        self.act = nn.Sigmoid()  # Sigmoidæ¿€æ´»å‡½æ•°

    def forward(self, x: torch.Tensor) -> torch.Tensor:
        """å¯¹è¾“å…¥åº”ç”¨é€šé“æ³¨æ„åŠ›æœºåˆ¶ã€‚"""
        return x * self.act(self.fc(self.pool(x)))

class SpatialAttention(nn.Module):
    """ç©ºé—´æ³¨æ„åŠ›æ¨¡å—ã€‚"""

    def __init__(self, kernel_size=7):
        """åˆå§‹åŒ–ç©ºé—´æ³¨æ„åŠ›æ¨¡å—ã€‚"""
        super().__init__()
        assert kernel_size in (3, 7), "kernel size must be 3 or 7"
        padding = 3 if kernel_size == 7 else 1
        self.cv1 = nn.Conv2d(2, 1, kernel_size, padding=padding, bias=False)  # å·ç§¯å±‚
        self.act = nn.Sigmoid()  # Sigmoidæ¿€æ´»å‡½æ•°

    def forward(self, x):
        """å¯¹è¾“å…¥åº”ç”¨ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶ã€‚"""
        return x * self.act(self.cv1(torch.cat([torch.mean(x, 1, keepdim=True), torch.max(x, 1, keepdim=True)[0]], 1)))

class CBAM(nn.Module):
    """å·ç§¯å—æ³¨æ„åŠ›æ¨¡å—ã€‚"""

    def __init__(self, c1, kernel_size=7):
        """åˆå§‹åŒ–CBAMæ¨¡å—ã€‚"""
        super().__init__()
        self.channel_attention = ChannelAttention(c1)  # é€šé“æ³¨æ„åŠ›
        self.spatial_attention = SpatialAttention(kernel_size)  # ç©ºé—´æ³¨æ„åŠ›

    def forward(self, x):
        """å¯¹è¾“å…¥åº”ç”¨CBAMæ¨¡å—ã€‚"""
        return self.spatial_attention(self.channel_attention(x))
```

### ä»£ç è¯´æ˜
1. **è‡ªåŠ¨å¡«å……å‡½æ•° `autopad`**: ç”¨äºè®¡ç®—å·ç§¯æ“ä½œæ—¶çš„å¡«å……ï¼Œä»¥ç¡®ä¿è¾“å‡ºçš„å½¢çŠ¶ä¸è¾“å…¥ç›¸åŒã€‚
2. **å·ç§¯ç±» `Conv`**: å®ç°äº†æ ‡å‡†çš„å·ç§¯æ“ä½œï¼ŒåŒ…å«å·ç§¯ã€æ‰¹å½’ä¸€åŒ–å’Œæ¿€æ´»å‡½æ•°ã€‚
3. **æ·±åº¦å·ç§¯ç±» `DWConv`**: ç»§æ‰¿è‡ª `Conv`ï¼Œå®ç°äº†æ·±åº¦å·ç§¯çš„åŠŸèƒ½ã€‚
4. **è½¬ç½®å·ç§¯ç±» `ConvTranspose`**: å®ç°äº†è½¬ç½®å·ç§¯æ“ä½œï¼Œå¸¸ç”¨äºä¸Šé‡‡æ ·ã€‚
5. **é€šé“æ³¨æ„åŠ›æ¨¡å— `ChannelAttention`**: é€šè¿‡è‡ªé€‚åº”å¹³å‡æ± åŒ–å’Œ1x1å·ç§¯å®ç°é€šé“æ³¨æ„åŠ›æœºåˆ¶ã€‚
6. **ç©ºé—´æ³¨æ„åŠ›æ¨¡å— `SpatialAttention`**: é€šè¿‡å·ç§¯å’Œæ¿€æ´»å‡½æ•°å®ç°ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶ã€‚
7. **CBAMæ¨¡å— `CBAM`**: ç»“åˆé€šé“æ³¨æ„åŠ›å’Œç©ºé—´æ³¨æ„åŠ›ï¼Œå¢å¼ºç‰¹å¾è¡¨ç¤ºèƒ½åŠ›ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶æ˜¯Ultralytics YOLOæ¡†æ¶ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œä¸»è¦å®ç°äº†å„ç§å·ç§¯æ“ä½œçš„ç±»ã€‚é¦–å…ˆï¼Œæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€äº›å·ç§¯ç›¸å…³çš„æ¨¡å—ï¼Œè¿™äº›æ¨¡å—å¯ä»¥ç”¨äºæ„å»ºæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œç‰¹åˆ«æ˜¯åœ¨ç›®æ ‡æ£€æµ‹å’Œå›¾åƒå¤„ç†ä»»åŠ¡ä¸­ã€‚

æ–‡ä»¶çš„å¼€å¤´å¯¼å…¥äº†å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬`math`ã€`numpy`å’Œ`torch`ï¼Œå¹¶å®šä¹‰äº†ä¸€ä¸ª`autopad`å‡½æ•°ï¼Œç”¨äºæ ¹æ®å·ç§¯æ ¸çš„å¤§å°å’Œæ‰©å¼ ç‡è‡ªåŠ¨è®¡ç®—å¡«å……ï¼Œä»¥ç¡®ä¿è¾“å‡ºçš„å½¢çŠ¶ä¸è¾“å…¥ç›¸åŒã€‚

æ¥ä¸‹æ¥ï¼Œå®šä¹‰äº†å¤šä¸ªå·ç§¯ç±»ã€‚`Conv`ç±»æ˜¯æ ‡å‡†çš„å·ç§¯å±‚ï¼ŒåŒ…å«å·ç§¯æ“ä½œã€æ‰¹å½’ä¸€åŒ–å’Œæ¿€æ´»å‡½æ•°ã€‚å®ƒçš„æ„é€ å‡½æ•°æ¥å—å¤šä¸ªå‚æ•°ï¼Œå¦‚è¾“å…¥é€šé“æ•°ã€è¾“å‡ºé€šé“æ•°ã€å·ç§¯æ ¸å¤§å°ã€æ­¥å¹…ã€å¡«å……ã€åˆ†ç»„å’Œæ‰©å¼ ç­‰ã€‚`forward`æ–¹æ³•å®ç°äº†å‰å‘ä¼ æ’­ï¼Œä¾æ¬¡åº”ç”¨å·ç§¯ã€æ‰¹å½’ä¸€åŒ–å’Œæ¿€æ´»å‡½æ•°ã€‚

`Conv2`ç±»æ˜¯å¯¹`Conv`ç±»çš„ç®€åŒ–ï¼Œå¢åŠ äº†ä¸€ä¸ª1x1çš„å·ç§¯å±‚ï¼Œç”¨äºå¹¶è¡Œå·ç§¯çš„èåˆã€‚å®ƒçš„`fuse_convs`æ–¹æ³•ç”¨äºå°†ä¸¤ä¸ªå·ç§¯å±‚èåˆä¸ºä¸€ä¸ªï¼Œä»¥æé«˜è®¡ç®—æ•ˆç‡ã€‚

`LightConv`ç±»å®ç°äº†ä¸€ç§è½»é‡çº§å·ç§¯ç»“æ„ï¼Œä½¿ç”¨äº†ä¸¤ä¸ªå·ç§¯å±‚ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯æ·±åº¦å·ç§¯ï¼ˆ`DWConv`ï¼‰ï¼Œåè€…ç”¨äºå‡å°‘è®¡ç®—é‡ã€‚

`DWConv`ç±»å®ç°äº†æ·±åº¦å·ç§¯ï¼Œ`DWConvTranspose2d`ç±»å®ç°äº†æ·±åº¦è½¬ç½®å·ç§¯ï¼ŒäºŒè€…éƒ½é€šè¿‡åˆ†ç»„å·ç§¯æ¥å‡å°‘å‚æ•°æ•°é‡å’Œè®¡ç®—é‡ã€‚

`ConvTranspose`ç±»æ˜¯è½¬ç½®å·ç§¯å±‚çš„å®ç°ï¼Œæ”¯æŒæ‰¹å½’ä¸€åŒ–å’Œæ¿€æ´»å‡½æ•°ã€‚`Focus`ç±»åˆ™ç”¨äºå°†ç©ºé—´ä¿¡æ¯èšç„¦åˆ°é€šé“ä¸Šï¼Œé€šè¿‡å¯¹è¾“å…¥å¼ é‡è¿›è¡Œç‰¹å®šçš„åˆ‡ç‰‡å’Œæ‹¼æ¥æ“ä½œã€‚

`GhostConv`ç±»å®ç°äº†Ghostå·ç§¯ï¼Œè¿™æ˜¯ä¸€ç§é€šè¿‡ç”Ÿæˆé¢å¤–çš„ç‰¹å¾å›¾æ¥æé«˜è®¡ç®—æ•ˆç‡çš„å·ç§¯æ–¹æ³•ã€‚

`RepConv`ç±»å®ç°äº†ä¸€ç§é‡å‚æ•°åŒ–å·ç§¯ï¼Œå…è®¸åœ¨è®­ç»ƒå’Œæ¨ç†é˜¶æ®µä½¿ç”¨ä¸åŒçš„å·ç§¯ç»“æ„ï¼Œä»¥æé«˜æ¨¡å‹çš„çµæ´»æ€§å’Œæ€§èƒ½ã€‚

æ¥ä¸‹æ¥æ˜¯æ³¨æ„åŠ›æœºåˆ¶çš„å®ç°ï¼ŒåŒ…æ‹¬`ChannelAttention`å’Œ`SpatialAttention`ç±»ï¼Œåˆ†åˆ«ç”¨äºé€šé“æ³¨æ„åŠ›å’Œç©ºé—´æ³¨æ„åŠ›ã€‚`CBAM`ç±»ç»“åˆäº†è¿™ä¸¤ç§æ³¨æ„åŠ›æœºåˆ¶ï¼Œä»¥å¢å¼ºç‰¹å¾è¡¨ç¤ºã€‚

æœ€åï¼Œ`Concat`ç±»ç”¨äºåœ¨æŒ‡å®šç»´åº¦ä¸Šè¿æ¥å¤šä¸ªå¼ é‡ï¼Œå¸¸ç”¨äºåœ¨ç½‘ç»œä¸­åˆå¹¶ä¸åŒå±‚çš„ç‰¹å¾å›¾ã€‚

æ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº†å¤šç§å·ç§¯å’Œæ³¨æ„åŠ›æœºåˆ¶çš„æ¨¡å—ï¼Œæä¾›äº†çµæ´»çš„æ„å»ºå—ï¼Œä»¥ä¾¿åœ¨YOLOæ¨¡å‹ä¸­ä½¿ç”¨ã€‚è¿™äº›æ¨¡å—é€šè¿‡ç»„åˆå’Œé‡ç”¨ï¼Œå¯ä»¥æ„å»ºå‡ºé«˜æ•ˆä¸”æ€§èƒ½ä¼˜è¶Šçš„æ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚

#### 11.4 ultralytics\models\yolo\segment\predict.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
from ultralytics.engine.results import Results  # å¯¼å…¥ç»“æœå¤„ç†ç±»
from ultralytics.models.yolo.detect.predict import DetectionPredictor  # å¯¼å…¥æ£€æµ‹é¢„æµ‹å™¨åŸºç±»
from ultralytics.utils import DEFAULT_CFG, ops  # å¯¼å…¥é»˜è®¤é…ç½®å’Œæ“ä½œå·¥å…·

class SegmentationPredictor(DetectionPredictor):
    """
    æ‰©å±•DetectionPredictorç±»çš„åˆ†å‰²é¢„æµ‹å™¨ç±»ã€‚
    ç”¨äºåŸºäºåˆ†å‰²æ¨¡å‹è¿›è¡Œé¢„æµ‹ã€‚
    """

    def __init__(self, cfg=DEFAULT_CFG, overrides=None, _callbacks=None):
        """åˆå§‹åŒ–SegmentationPredictorï¼Œè®¾ç½®é…ç½®ã€è¦†ç›–å‚æ•°å’Œå›è°ƒå‡½æ•°ã€‚"""
        super().__init__(cfg, overrides, _callbacks)  # è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
        self.args.task = "segment"  # è®¾ç½®ä»»åŠ¡ç±»å‹ä¸ºåˆ†å‰²

    def postprocess(self, preds, img, orig_imgs):
        """å¯¹æ¯ä¸ªè¾“å…¥å›¾åƒçš„é¢„æµ‹ç»“æœè¿›è¡Œåå¤„ç†ï¼ŒåŒ…æ‹¬éæå¤§å€¼æŠ‘åˆ¶å’Œæ£€æµ‹å¤„ç†ã€‚"""
        # åº”ç”¨éæå¤§å€¼æŠ‘åˆ¶ï¼Œè¿‡æ»¤æ‰ä½ç½®ä¿¡åº¦çš„æ£€æµ‹æ¡†
        p = ops.non_max_suppression(
            preds[0],  # é¢„æµ‹ç»“æœ
            self.args.conf,  # ç½®ä¿¡åº¦é˜ˆå€¼
            self.args.iou,  # IOUé˜ˆå€¼
            agnostic=self.args.agnostic_nms,  # æ˜¯å¦è¿›è¡Œç±»åˆ«æ— å…³çš„NMS
            max_det=self.args.max_det,  # æœ€å¤§æ£€æµ‹æ¡†æ•°é‡
            nc=len(self.model.names),  # ç±»åˆ«æ•°é‡
            classes=self.args.classes,  # æŒ‡å®šçš„ç±»åˆ«
        )

        # å¦‚æœè¾“å…¥å›¾åƒä¸æ˜¯åˆ—è¡¨ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸ºnumpyæ•°ç»„
        if not isinstance(orig_imgs, list):
            orig_imgs = ops.convert_torch2numpy_batch(orig_imgs)

        results = []  # å­˜å‚¨å¤„ç†åçš„ç»“æœ
        proto = preds[1][-1] if len(preds[1]) == 3 else preds[1]  # è·å–åˆ†å‰²æ©ç çš„åŸå‹

        # éå†æ¯ä¸ªé¢„æµ‹ç»“æœ
        for i, pred in enumerate(p):
            orig_img = orig_imgs[i]  # è·å–åŸå§‹å›¾åƒ
            img_path = self.batch[0][i]  # è·å–å›¾åƒè·¯å¾„
            
            if not len(pred):  # å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°æ¡†
                masks = None  # æ©ç è®¾ç½®ä¸ºNone
            elif self.args.retina_masks:  # å¦‚æœä½¿ç”¨Retinaæ©ç 
                # å°†æ£€æµ‹æ¡†åæ ‡ç¼©æ”¾åˆ°åŸå§‹å›¾åƒå°ºå¯¸
                pred[:, :4] = ops.scale_boxes(img.shape[2:], pred[:, :4], orig_img.shape)
                # å¤„ç†æ©ç 
                masks = ops.process_mask_native(proto[i], pred[:, 6:], pred[:, :4], orig_img.shape[:2])  # HWC
            else:  # å¦åˆ™ä½¿ç”¨æ™®é€šæ©ç å¤„ç†
                masks = ops.process_mask(proto[i], pred[:, 6:], pred[:, :4], img.shape[2:], upsample=True)  # HWC
                # ç¼©æ”¾æ£€æµ‹æ¡†åæ ‡
                pred[:, :4] = ops.scale_boxes(img.shape[2:], pred[:, :4], orig_img.shape)
            
            # å°†ç»“æœå­˜å‚¨åˆ°Resultså¯¹è±¡ä¸­
            results.append(Results(orig_img, path=img_path, names=self.model.names, boxes=pred[:, :6], masks=masks))
        
        return results  # è¿”å›å¤„ç†åçš„ç»“æœåˆ—è¡¨
```

### ä»£ç æ ¸å¿ƒéƒ¨åˆ†è¯´æ˜ï¼š
1. **ç±»å®šä¹‰**ï¼š`SegmentationPredictor`ç±»ç»§æ‰¿è‡ª`DetectionPredictor`ï¼Œç”¨äºå®ç°åŸºäºåˆ†å‰²æ¨¡å‹çš„é¢„æµ‹åŠŸèƒ½ã€‚
2. **åˆå§‹åŒ–æ–¹æ³•**ï¼šæ„é€ å‡½æ•°ä¸­è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œå¹¶è®¾ç½®ä»»åŠ¡ç±»å‹ä¸ºâ€œsegmentâ€ã€‚
3. **åå¤„ç†æ–¹æ³•**ï¼š`postprocess`æ–¹æ³•å¯¹æ¨¡å‹çš„é¢„æµ‹ç»“æœè¿›è¡Œåå¤„ç†ï¼ŒåŒ…æ‹¬ï¼š
   - åº”ç”¨éæå¤§å€¼æŠ‘åˆ¶ï¼ˆNMSï¼‰æ¥è¿‡æ»¤ä½ç½®ä¿¡åº¦çš„æ£€æµ‹æ¡†ã€‚
   - å°†è¾“å…¥å›¾åƒè½¬æ¢ä¸ºnumpyæ•°ç»„ï¼ˆå¦‚æœä¸æ˜¯åˆ—è¡¨ï¼‰ã€‚
   - éå†æ¯ä¸ªé¢„æµ‹ç»“æœï¼Œå¤„ç†æ©ç å¹¶å°†ç»“æœå­˜å‚¨åœ¨`Results`å¯¹è±¡ä¸­ï¼Œæœ€ç»ˆè¿”å›å¤„ç†åçš„ç»“æœåˆ—è¡¨ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªåä¸º `SegmentationPredictor` çš„ç±»ï¼Œç»§æ‰¿è‡ª `DetectionPredictor` ç±»ï¼Œä¸»è¦ç”¨äºåŸºäºåˆ†å‰²æ¨¡å‹è¿›è¡Œé¢„æµ‹ã€‚æ–‡ä»¶çš„å¼€å¤´éƒ¨åˆ†åŒ…å«äº†ä¸€äº›ç‰ˆæƒä¿¡æ¯å’Œå¿…è¦çš„æ¨¡å—å¯¼å…¥ï¼ŒåŒ…æ‹¬ `Results` ç±»ã€`DetectionPredictor` ç±»å’Œä¸€äº›å·¥å…·å‡½æ•°ã€‚

åœ¨ `SegmentationPredictor` ç±»çš„æ„é€ å‡½æ•° `__init__` ä¸­ï¼Œé¦–å…ˆè°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œå¹¶ä¼ å…¥é…ç½®ã€è¦†ç›–å‚æ•°å’Œå›è°ƒå‡½æ•°ã€‚ç„¶åï¼Œå°†ä»»åŠ¡ç±»å‹è®¾ç½®ä¸º "segment"ï¼Œè¡¨æ˜è¯¥é¢„æµ‹å™¨æ˜¯ç”¨äºå›¾åƒåˆ†å‰²çš„ã€‚

ç±»ä¸­æœ€é‡è¦çš„æ–¹æ³•æ˜¯ `postprocess`ï¼Œè¯¥æ–¹æ³•è´Ÿè´£å¯¹æ¨¡å‹çš„é¢„æµ‹ç»“æœè¿›è¡Œåå¤„ç†ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒé¦–å…ˆä½¿ç”¨éæå¤§å€¼æŠ‘åˆ¶ï¼ˆNMSï¼‰æ¥è¿‡æ»¤æ‰é‡å çš„æ£€æµ‹æ¡†ï¼Œç¡®ä¿æ¯ä¸ªç›®æ ‡åªä¿ç•™ä¸€ä¸ªæœ€ä¼˜æ¡†ã€‚NMS çš„å‚æ•°åŒ…æ‹¬ç½®ä¿¡åº¦é˜ˆå€¼ã€IOU é˜ˆå€¼ã€æ˜¯å¦ä½¿ç”¨æ— å…³ç±»åˆ«çš„ NMSã€æœ€å¤§æ£€æµ‹æ•°é‡ã€ç±»åˆ«æ•°é‡ä»¥åŠæŒ‡å®šçš„ç±»åˆ«ã€‚

æ¥ä¸‹æ¥ï¼Œæ–¹æ³•ä¼šæ£€æŸ¥è¾“å…¥çš„åŸå§‹å›¾åƒæ˜¯å¦ä¸ºåˆ—è¡¨æ ¼å¼ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸º NumPy æ•°ç»„æ ¼å¼ã€‚ç„¶åï¼Œæ–¹æ³•ä¼šæ ¹æ®é¢„æµ‹ç»“æœçš„é•¿åº¦æ¥å¤„ç†æ©ç ï¼ˆmasksï¼‰ã€‚å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°ç›®æ ‡ï¼Œæ©ç å°†è¢«è®¾ç½®ä¸º `None`ã€‚å¦‚æœå¯ç”¨äº† `retina_masks`ï¼Œåˆ™ä¼šä½¿ç”¨åŸç”Ÿçš„æ©ç å¤„ç†å‡½æ•°ï¼›å¦åˆ™ï¼Œä½¿ç”¨æ ‡å‡†çš„æ©ç å¤„ç†å‡½æ•°ï¼Œå¹¶è¿›è¡Œå¿…è¦çš„ä¸Šé‡‡æ ·ã€‚

æœ€åï¼Œæ–¹æ³•å°†å¤„ç†åçš„ç»“æœå­˜å‚¨åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œæ¯ä¸ªç»“æœåŒ…å«åŸå§‹å›¾åƒã€å›¾åƒè·¯å¾„ã€ç±»åˆ«åç§°ã€æ£€æµ‹æ¡†å’Œæ©ç ã€‚æœ€ç»ˆï¼Œè¿”å›è¿™ä¸ªç»“æœåˆ—è¡¨ã€‚

æ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº†ä¸€ä¸ªç”¨äºå›¾åƒåˆ†å‰²çš„é¢„æµ‹å™¨ï¼Œæä¾›äº†ä»æ¨¡å‹è¾“å‡ºåˆ°å¯ç”¨ç»“æœçš„å®Œæ•´å¤„ç†æµç¨‹ã€‚é€šè¿‡è¿™ä¸ªç±»ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œå›¾åƒåˆ†å‰²ä»»åŠ¡ï¼Œå¹¶è·å–å¤„ç†åçš„ç»“æœã€‚

#### 11.5 ultralytics\solutions\heatmap.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å’Œæ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼š

```python
import cv2
import numpy as np
from collections import defaultdict
from shapely.geometry import LineString, Point, Polygon

class Heatmap:
    """ç”¨äºå®æ—¶è§†é¢‘æµä¸­ç»˜åˆ¶çƒ­å›¾çš„ç±»ï¼ŒåŸºäºç‰©ä½“çš„è½¨è¿¹ã€‚"""

    def __init__(self):
        """åˆå§‹åŒ–çƒ­å›¾ç±»ï¼Œè®¾ç½®é»˜è®¤å€¼ã€‚"""
        # è§†è§‰ä¿¡æ¯
        self.annotator = None  # æ³¨é‡Šå™¨ï¼Œç”¨äºç»˜åˆ¶
        self.view_img = False  # æ˜¯å¦æ˜¾ç¤ºå›¾åƒ
        self.shape = "circle"  # çƒ­å›¾å½¢çŠ¶ï¼Œé»˜è®¤ä¸ºåœ†å½¢

        # å›¾åƒä¿¡æ¯
        self.imw = None  # å›¾åƒå®½åº¦
        self.imh = None  # å›¾åƒé«˜åº¦
        self.im0 = None  # åŸå§‹å›¾åƒ
        self.view_in_counts = True  # æ˜¯å¦æ˜¾ç¤ºè¿›å…¥è®¡æ•°
        self.view_out_counts = True  # æ˜¯å¦æ˜¾ç¤ºç¦»å¼€è®¡æ•°

        # çƒ­å›¾ç›¸å…³
        self.colormap = None  # çƒ­å›¾é¢œè‰²æ˜ å°„
        self.heatmap = None  # çƒ­å›¾æ•°ç»„
        self.heatmap_alpha = 0.5  # çƒ­å›¾é€æ˜åº¦

        # é¢„æµ‹/è·Ÿè¸ªä¿¡æ¯
        self.boxes = None  # ç‰©ä½“æ¡†
        self.track_ids = None  # è·Ÿè¸ªID
        self.clss = None  # ç±»åˆ«
        self.track_history = defaultdict(list)  # è·Ÿè¸ªå†å²

        # è®¡æ•°åŒºåŸŸä¿¡æ¯
        self.count_reg_pts = None  # è®¡æ•°åŒºåŸŸç‚¹
        self.counting_region = None  # è®¡æ•°åŒºåŸŸ
        self.line_dist_thresh = 15  # çº¿è®¡æ•°çš„è·ç¦»é˜ˆå€¼
        self.region_thickness = 5  # åŒºåŸŸåšåº¦
        self.region_color = (255, 0, 255)  # åŒºåŸŸé¢œè‰²

        # ç‰©ä½“è®¡æ•°ä¿¡æ¯
        self.in_counts = 0  # è¿›å…¥è®¡æ•°
        self.out_counts = 0  # ç¦»å¼€è®¡æ•°
        self.counting_list = []  # æ­£åœ¨è®¡æ•°çš„ç‰©ä½“åˆ—è¡¨

        # è¡°å‡å› å­
        self.decay_factor = 0.99  # çƒ­å›¾è¡°å‡å› å­

    def set_args(self, imw, imh, colormap=cv2.COLORMAP_JET, heatmap_alpha=0.5, view_img=False,
                 view_in_counts=True, view_out_counts=True, count_reg_pts=None,
                 region_thickness=5, line_dist_thresh=15, decay_factor=0.99, shape="circle"):
        """
        é…ç½®çƒ­å›¾çš„å‚æ•°ï¼ŒåŒ…æ‹¬å®½åº¦ã€é«˜åº¦å’Œæ˜¾ç¤ºå‚æ•°ã€‚
        """
        self.imw = imw
        self.imh = imh
        self.heatmap_alpha = heatmap_alpha
        self.view_img = view_img
        self.view_in_counts = view_in_counts
        self.view_out_counts = view_out_counts
        self.colormap = colormap

        # è®¾ç½®è®¡æ•°åŒºåŸŸ
        if count_reg_pts is not None:
            if len(count_reg_pts) == 2:  # çº¿è®¡æ•°
                self.count_reg_pts = count_reg_pts
                self.counting_region = LineString(count_reg_pts)
            elif len(count_reg_pts) == 4:  # åŒºåŸŸè®¡æ•°
                self.count_reg_pts = count_reg_pts
                self.counting_region = Polygon(self.count_reg_pts)
            else:
                print("æ— æ•ˆçš„è®¡æ•°åŒºåŸŸç‚¹ï¼Œæ”¯æŒ2æˆ–4ä¸ªç‚¹")
                self.counting_region = Polygon([(20, 400), (1260, 400)])  # é»˜è®¤çº¿

        # åˆå§‹åŒ–çƒ­å›¾
        self.heatmap = np.zeros((int(self.imh), int(self.imw)), dtype=np.float32)

        # å…¶ä»–å‚æ•°è®¾ç½®
        self.region_thickness = region_thickness
        self.decay_factor = decay_factor
        self.line_dist_thresh = line_dist_thresh
        self.shape = shape if shape in ["circle", "rect"] else "circle"  # é»˜è®¤åœ†å½¢

    def extract_results(self, tracks):
        """ä»è·Ÿè¸ªæ•°æ®ä¸­æå–ç»“æœã€‚"""
        self.boxes = tracks[0].boxes.xyxy.cpu()  # ç‰©ä½“æ¡†
        self.clss = tracks[0].boxes.cls.cpu().tolist()  # ç±»åˆ«
        self.track_ids = tracks[0].boxes.id.int().cpu().tolist()  # è·Ÿè¸ªID

    def generate_heatmap(self, im0, tracks):
        """æ ¹æ®è·Ÿè¸ªæ•°æ®ç”Ÿæˆçƒ­å›¾ã€‚"""
        self.im0 = im0  # è®¾ç½®å½“å‰å›¾åƒ
        if tracks[0].boxes.id is None:  # å¦‚æœæ²¡æœ‰è·Ÿè¸ªID
            return

        self.heatmap *= self.decay_factor  # åº”ç”¨è¡°å‡å› å­
        self.extract_results(tracks)  # æå–è·Ÿè¸ªç»“æœ

        # å¤„ç†è®¡æ•°åŒºåŸŸ
        if self.count_reg_pts is not None:
            for box, track_id in zip(self.boxes, self.track_ids):
                # è®¡ç®—çƒ­å›¾
                center = (int((box[0] + box[2]) // 2), int((box[1] + box[3]) // 2))
                radius = min(int(box[2]) - int(box[0]), int(box[3]) - int(box[1])) // 2
                y, x = np.ogrid[0:self.heatmap.shape[0], 0:self.heatmap.shape[1]]
                mask = (x - center[0]) ** 2 + (y - center[1]) ** 2 <= radius**2
                self.heatmap[int(box[1]):int(box[3]), int(box[0]):int(box[2])] += (2 * mask[int(box[1]):int(box[3]), int(box[0]):int(box[2])])

                # è®¡æ•°é€»è¾‘
                track_line = self.track_history[track_id]
                track_line.append((float((box[0] + box[2]) / 2), float((box[1] + box[3]) / 2)))
                if len(track_line) > 30:
                    track_line.pop(0)

                # åˆ¤æ–­ç‰©ä½“æ˜¯å¦è¿›å…¥æˆ–ç¦»å¼€è®¡æ•°åŒºåŸŸ
                if self.counting_region.contains(Point(track_line[-1])) and track_id not in self.counting_list:
                    self.counting_list.append(track_id)
                    if box[0] < self.counting_region.centroid.x:
                        self.out_counts += 1
                    else:
                        self.in_counts += 1

        # å½’ä¸€åŒ–çƒ­å›¾å¹¶ä¸åŸå§‹å›¾åƒç»“åˆ
        heatmap_normalized = cv2.normalize(self.heatmap, None, 0, 255, cv2.NORM_MINMAX)
        heatmap_colored = cv2.applyColorMap(heatmap_normalized.astype(np.uint8), self.colormap)
        self.im0 = cv2.addWeighted(self.im0, 1 - self.heatmap_alpha, heatmap_colored, self.heatmap_alpha, 0)

        return self.im0  # è¿”å›åˆæˆåçš„å›¾åƒ

    def display_frames(self):
        """æ˜¾ç¤ºå½“å‰å¸§ã€‚"""
        cv2.imshow("Ultralytics Heatmap", self.im0)
        if cv2.waitKey(1) & 0xFF == ord("q"):
            return

if __name__ == "__main__":
    Heatmap()  # åˆ›å»ºçƒ­å›¾å®ä¾‹
```

### ä»£ç æ³¨é‡Šè¯´æ˜ï¼š
1. **ç±»å’Œæ–¹æ³•çš„å®šä¹‰**ï¼š`Heatmap`ç±»ç”¨äºå¤„ç†çƒ­å›¾çš„ç”Ÿæˆå’Œæ˜¾ç¤ºï¼ŒåŒ…å«å¤šä¸ªæ–¹æ³•æ¥è®¾ç½®å‚æ•°ã€æå–ç»“æœã€ç”Ÿæˆçƒ­å›¾å’Œæ˜¾ç¤ºå¸§ã€‚
2. **åˆå§‹åŒ–æ–¹æ³•**ï¼šåœ¨`__init__`ä¸­ï¼Œè®¾ç½®äº†çƒ­å›¾çš„åˆå§‹çŠ¶æ€ï¼ŒåŒ…æ‹¬è§†è§‰ä¿¡æ¯ã€å›¾åƒä¿¡æ¯ã€çƒ­å›¾ç›¸å…³å‚æ•°ã€é¢„æµ‹è·Ÿè¸ªä¿¡æ¯å’Œè®¡æ•°åŒºåŸŸä¿¡æ¯ã€‚
3. **å‚æ•°è®¾ç½®**ï¼š`set_args`æ–¹æ³•ç”¨äºé…ç½®çƒ­å›¾çš„å„ç§å‚æ•°ï¼ŒåŒ…æ‹¬å›¾åƒå°ºå¯¸ã€é¢œè‰²æ˜ å°„ã€é€æ˜åº¦ç­‰ï¼Œå¹¶æ ¹æ®æä¾›çš„ç‚¹è®¾ç½®è®¡æ•°åŒºåŸŸã€‚
4. **ç»“æœæå–**ï¼š`extract_results`æ–¹æ³•ä»è·Ÿè¸ªæ•°æ®ä¸­æå–ç‰©ä½“æ¡†ã€ç±»åˆ«å’Œè·Ÿè¸ªIDã€‚
5. **çƒ­å›¾ç”Ÿæˆ**ï¼š`generate_heatmap`æ–¹æ³•æ ¹æ®è·Ÿè¸ªæ•°æ®ç”Ÿæˆçƒ­å›¾ï¼Œè®¡ç®—æ¯ä¸ªç‰©ä½“çš„çƒ­åº¦ï¼Œå¹¶æ›´æ–°è®¡æ•°ã€‚
6. **æ˜¾ç¤ºå¸§**ï¼š`display_frames`æ–¹æ³•ç”¨äºåœ¨çª—å£ä¸­æ˜¾ç¤ºå½“å‰å¸§ï¼Œå¹¶å…è®¸ç”¨æˆ·é€šè¿‡æŒ‰é”®é€€å‡ºã€‚

é€šè¿‡è¿™äº›æ³¨é‡Šï¼Œå¯ä»¥æ›´å¥½åœ°ç†è§£ä»£ç çš„ç»“æ„å’ŒåŠŸèƒ½ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªåä¸º `Heatmap` çš„ç±»ï¼Œç”¨äºåœ¨å®æ—¶è§†é¢‘æµä¸­åŸºäºç‰©ä½“è½¨è¿¹ç»˜åˆ¶çƒ­å›¾ã€‚è¯¥ç±»åŒ…å«å¤šä¸ªæ–¹æ³•å’Œå±æ€§ï¼Œèƒ½å¤Ÿå¤„ç†è§†é¢‘å¸§ã€ç”Ÿæˆçƒ­å›¾å¹¶è¿›è¡Œç‰©ä½“è®¡æ•°ã€‚

åœ¨åˆå§‹åŒ–æ–¹æ³• `__init__` ä¸­ï¼Œç±»çš„å„ç§å±æ€§è¢«è®¾ç½®ä¸ºé»˜è®¤å€¼ï¼ŒåŒ…æ‹¬å¯è§†åŒ–ä¿¡æ¯ã€å›¾åƒä¿¡æ¯ã€çƒ­å›¾çš„é¢œè‰²æ˜ å°„å’Œæ•°ç»„ã€ç‰©ä½“è¿½è¸ªä¿¡æ¯ã€è®¡æ•°åŒºåŸŸå’Œçº¿çš„ä¿¡æ¯ã€è®¡æ•°ä¿¡æ¯ä»¥åŠè¡°å‡å› å­ç­‰ã€‚æ­¤å¤–ï¼Œç¨‹åºè¿˜æ£€æŸ¥ç¯å¢ƒæ˜¯å¦æ”¯æŒå›¾åƒæ˜¾ç¤ºã€‚

`set_args` æ–¹æ³•ç”¨äºé…ç½®çƒ­å›¾çš„å‚æ•°ï¼ŒåŒ…æ‹¬å›¾åƒçš„å®½åº¦å’Œé«˜åº¦ã€é¢œè‰²æ˜ å°„ã€é€æ˜åº¦ã€æ˜¯å¦æ˜¾ç¤ºå›¾åƒã€è®¡æ•°åŒºåŸŸçš„ç‚¹ã€æ–‡æœ¬åšåº¦å’Œé¢œè‰²ç­‰ã€‚è¯¥æ–¹æ³•æ ¹æ®ä¼ å…¥çš„è®¡æ•°åŒºåŸŸç‚¹æ•°ï¼ˆ2æˆ–4ä¸ªç‚¹ï¼‰æ¥åˆå§‹åŒ–è®¡æ•°åŒºåŸŸï¼Œå¹¶è®¾ç½®çƒ­å›¾çš„åˆå§‹çŠ¶æ€ã€‚

`extract_results` æ–¹æ³•ä»ç‰©ä½“è¿½è¸ªè¿‡ç¨‹ä¸­æå–ç»“æœï¼ŒåŒ…æ‹¬ç‰©ä½“çš„è¾¹ç•Œæ¡†ã€ç±»åˆ«å’Œè¿½è¸ªIDã€‚

`generate_heatmap` æ–¹æ³•æ˜¯è¯¥ç±»çš„æ ¸å¿ƒï¼Œè´Ÿè´£ç”Ÿæˆçƒ­å›¾ã€‚å®ƒæ¥æ”¶å½“å‰å¸§å›¾åƒå’Œè¿½è¸ªæ•°æ®ï¼Œé¦–å…ˆå¯¹çƒ­å›¾è¿›è¡Œè¡°å‡å¤„ç†ï¼Œç„¶åæå–è¿½è¸ªç»“æœã€‚æ ¹æ®è¿½è¸ªåˆ°çš„ç‰©ä½“ä¿¡æ¯ï¼Œç¨‹åºåœ¨çƒ­å›¾ä¸Šç»˜åˆ¶ç›¸åº”çš„å½¢çŠ¶ï¼ˆåœ†å½¢æˆ–çŸ©å½¢ï¼‰ï¼Œå¹¶æ›´æ–°çƒ­å›¾çš„å€¼ã€‚åŒæ—¶ï¼Œç¨‹åºä¼šæ ¹æ®ç‰©ä½“çš„ä½ç½®åˆ¤æ–­æ˜¯å¦è¿›å…¥æˆ–ç¦»å¼€è®¡æ•°åŒºåŸŸï¼Œå¹¶æ›´æ–°è®¡æ•°ä¿¡æ¯ã€‚

æœ€åï¼Œç¨‹åºä¼šå¯¹çƒ­å›¾è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œåº”ç”¨é¢œè‰²æ˜ å°„ï¼Œå¹¶å°†å…¶ä¸åŸå§‹å›¾åƒåˆæˆã€‚æ ¹æ®ç”¨æˆ·çš„é€‰æ‹©ï¼Œç¨‹åºè¿˜ä¼šåœ¨å›¾åƒä¸Šæ˜¾ç¤ºè¿›å…¥å’Œç¦»å¼€çš„è®¡æ•°ä¿¡æ¯ã€‚å¦‚æœè®¾ç½®äº†æ˜¾ç¤ºå›¾åƒçš„æ ‡å¿—ï¼Œç¨‹åºä¼šè°ƒç”¨ `display_frames` æ–¹æ³•æ¥å±•ç¤ºå½“å‰å¸§ã€‚

`display_frames` æ–¹æ³•ç”¨äºæ˜¾ç¤ºå½“å‰å¤„ç†çš„å¸§ï¼Œå¹¶å…è®¸ç”¨æˆ·é€šè¿‡æŒ‰ä¸‹â€œqâ€é”®é€€å‡ºæ˜¾ç¤ºã€‚

æ•´ä¸ªç±»çš„è®¾è®¡æ—¨åœ¨å®ç°å®æ—¶è§†é¢‘åˆ†æï¼Œæä¾›çƒ­å›¾å¯è§†åŒ–å’Œç‰©ä½“è®¡æ•°åŠŸèƒ½ï¼Œé€‚ç”¨äºç›‘æ§ã€äº¤é€šåˆ†æç­‰åœºæ™¯ã€‚

#### 11.6 ultralytics\utils\tal.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import torch
import torch.nn as nn

class TaskAlignedAssigner(nn.Module):
    """
    ä»»åŠ¡å¯¹é½åˆ†é…å™¨ï¼Œç”¨äºç›®æ ‡æ£€æµ‹ã€‚

    è¯¥ç±»æ ¹æ®ä»»åŠ¡å¯¹é½æŒ‡æ ‡å°†çœŸå®ç‰©ä½“ï¼ˆground-truthï¼‰åˆ†é…ç»™é”šæ¡†ï¼ˆanchorsï¼‰ï¼Œè¯¥æŒ‡æ ‡ç»“åˆäº†åˆ†ç±»å’Œå®šä½ä¿¡æ¯ã€‚
    """

    def __init__(self, topk=13, num_classes=80, alpha=1.0, beta=6.0, eps=1e-9):
        """åˆå§‹åŒ–ä»»åŠ¡å¯¹é½åˆ†é…å™¨å¯¹è±¡ï¼Œå…è®¸è‡ªå®šä¹‰è¶…å‚æ•°ã€‚"""
        super().__init__()
        self.topk = topk  # è€ƒè™‘çš„å‰kä¸ªå€™é€‰æ¡†
        self.num_classes = num_classes  # ç›®æ ‡ç±»åˆ«æ•°é‡
        self.bg_idx = num_classes  # èƒŒæ™¯ç±»åˆ«ç´¢å¼•
        self.alpha = alpha  # åˆ†ç±»éƒ¨åˆ†çš„è¶…å‚æ•°
        self.beta = beta  # å®šä½éƒ¨åˆ†çš„è¶…å‚æ•°
        self.eps = eps  # é˜²æ­¢é™¤ä»¥é›¶çš„å°å€¼

    @torch.no_grad()
    def forward(self, pd_scores, pd_bboxes, anc_points, gt_labels, gt_bboxes, mask_gt):
        """
        è®¡ç®—ä»»åŠ¡å¯¹é½åˆ†é…ã€‚

        å‚æ•°:
            pd_scores (Tensor): é¢„æµ‹å¾—åˆ†ï¼Œå½¢çŠ¶ä¸º(bs, num_total_anchors, num_classes)
            pd_bboxes (Tensor): é¢„æµ‹è¾¹ç•Œæ¡†ï¼Œå½¢çŠ¶ä¸º(bs, num_total_anchors, 4)
            anc_points (Tensor): é”šæ¡†ä¸­å¿ƒç‚¹ï¼Œå½¢çŠ¶ä¸º(num_total_anchors, 2)
            gt_labels (Tensor): çœŸå®æ ‡ç­¾ï¼Œå½¢çŠ¶ä¸º(bs, n_max_boxes, 1)
            gt_bboxes (Tensor): çœŸå®è¾¹ç•Œæ¡†ï¼Œå½¢çŠ¶ä¸º(bs, n_max_boxes, 4)
            mask_gt (Tensor): çœŸå®æ¡†æ©ç ï¼Œå½¢çŠ¶ä¸º(bs, n_max_boxes, 1)

        è¿”å›:
            target_labels (Tensor): ç›®æ ‡æ ‡ç­¾ï¼Œå½¢çŠ¶ä¸º(bs, num_total_anchors)
            target_bboxes (Tensor): ç›®æ ‡è¾¹ç•Œæ¡†ï¼Œå½¢çŠ¶ä¸º(bs, num_total_anchors, 4)
            target_scores (Tensor): ç›®æ ‡å¾—åˆ†ï¼Œå½¢çŠ¶ä¸º(bs, num_total_anchors, num_classes)
            fg_mask (Tensor): å‰æ™¯æ©ç ï¼Œå½¢çŠ¶ä¸º(bs, num_total_anchors)
            target_gt_idx (Tensor): ç›®æ ‡çœŸå®ç´¢å¼•ï¼Œå½¢çŠ¶ä¸º(bs, num_total_anchors)
        """
        self.bs = pd_scores.size(0)  # æ‰¹é‡å¤§å°
        self.n_max_boxes = gt_bboxes.size(1)  # æœ€å¤§çœŸå®æ¡†æ•°é‡

        if self.n_max_boxes == 0:  # å¦‚æœæ²¡æœ‰çœŸå®æ¡†
            device = gt_bboxes.device
            return (
                torch.full_like(pd_scores[..., 0], self.bg_idx).to(device),  # è¿”å›èƒŒæ™¯æ ‡ç­¾
                torch.zeros_like(pd_bboxes).to(device),  # è¿”å›é›¶è¾¹ç•Œæ¡†
                torch.zeros_like(pd_scores).to(device),  # è¿”å›é›¶å¾—åˆ†
                torch.zeros_like(pd_scores[..., 0]).to(device),  # è¿”å›é›¶å‰æ™¯æ©ç 
                torch.zeros_like(pd_scores[..., 0]).to(device),  # è¿”å›é›¶çœŸå®ç´¢å¼•
            )

        # è·å–æ­£æ ·æœ¬æ©ç ã€å¯¹é½æŒ‡æ ‡å’Œé‡å åº¦
        mask_pos, align_metric, overlaps = self.get_pos_mask(
            pd_scores, pd_bboxes, gt_labels, gt_bboxes, anc_points, mask_gt
        )

        # é€‰æ‹©é‡å åº¦æœ€é«˜çš„çœŸå®æ¡†
        target_gt_idx, fg_mask, mask_pos = self.select_highest_overlaps(mask_pos, overlaps, self.n_max_boxes)

        # è·å–ç›®æ ‡æ ‡ç­¾ã€è¾¹ç•Œæ¡†å’Œå¾—åˆ†
        target_labels, target_bboxes, target_scores = self.get_targets(gt_labels, gt_bboxes, target_gt_idx, fg_mask)

        # å½’ä¸€åŒ–å¯¹é½æŒ‡æ ‡
        align_metric *= mask_pos
        pos_align_metrics = align_metric.amax(dim=-1, keepdim=True)  # è®¡ç®—æ­£æ ·æœ¬çš„æœ€å¤§å¯¹é½æŒ‡æ ‡
        pos_overlaps = (overlaps * mask_pos).amax(dim=-1, keepdim=True)  # è®¡ç®—æ­£æ ·æœ¬çš„æœ€å¤§é‡å åº¦
        norm_align_metric = (align_metric * pos_overlaps / (pos_align_metrics + self.eps)).amax(-2).unsqueeze(-1)
        target_scores = target_scores * norm_align_metric  # æ›´æ–°ç›®æ ‡å¾—åˆ†

        return target_labels, target_bboxes, target_scores, fg_mask.bool(), target_gt_idx

    def get_pos_mask(self, pd_scores, pd_bboxes, gt_labels, gt_bboxes, anc_points, mask_gt):
        """è·å–æ­£æ ·æœ¬æ©ç å’Œå¯¹é½æŒ‡æ ‡ã€‚"""
        mask_in_gts = self.select_candidates_in_gts(anc_points, gt_bboxes)  # é€‰æ‹©åœ¨çœŸå®æ¡†å†…çš„é”šæ¡†
        align_metric, overlaps = self.get_box_metrics(pd_scores, pd_bboxes, gt_labels, gt_bboxes, mask_in_gts * mask_gt)  # è®¡ç®—å¯¹é½æŒ‡æ ‡å’Œé‡å åº¦
        mask_topk = self.select_topk_candidates(align_metric, topk_mask=mask_gt.expand(-1, -1, self.topk).bool())  # é€‰æ‹©å‰kä¸ªå€™é€‰æ¡†
        mask_pos = mask_topk * mask_in_gts * mask_gt  # åˆå¹¶æ©ç 

        return mask_pos, align_metric, overlaps

    def get_box_metrics(self, pd_scores, pd_bboxes, gt_labels, gt_bboxes, mask_gt):
        """è®¡ç®—é¢„æµ‹è¾¹ç•Œæ¡†ä¸çœŸå®è¾¹ç•Œæ¡†çš„å¯¹é½æŒ‡æ ‡ã€‚"""
        na = pd_bboxes.shape[-2]  # é”šæ¡†æ•°é‡
        mask_gt = mask_gt.bool()  # è½¬æ¢ä¸ºå¸ƒå°”ç±»å‹
        overlaps = torch.zeros([self.bs, self.n_max_boxes, na], dtype=pd_bboxes.dtype, device=pd_bboxes.device)  # åˆå§‹åŒ–é‡å åº¦
        bbox_scores = torch.zeros([self.bs, self.n_max_boxes, na], dtype=pd_scores.dtype, device=pd_scores.device)  # åˆå§‹åŒ–è¾¹ç•Œæ¡†å¾—åˆ†

        ind = torch.zeros([2, self.bs, self.n_max_boxes], dtype=torch.long)  # åˆå§‹åŒ–ç´¢å¼•
        ind[0] = torch.arange(end=self.bs).view(-1, 1).expand(-1, self.n_max_boxes)  # æ‰¹é‡ç´¢å¼•
        ind[1] = gt_labels.squeeze(-1)  # çœŸå®æ ‡ç­¾ç´¢å¼•
        bbox_scores[mask_gt] = pd_scores[ind[0], :, ind[1]][mask_gt]  # è·å–æ¯ä¸ªçœŸå®æ¡†çš„å¾—åˆ†

        # è®¡ç®—é‡å åº¦
        pd_boxes = pd_bboxes.unsqueeze(1).expand(-1, self.n_max_boxes, -1, -1)[mask_gt]
        gt_boxes = gt_bboxes.unsqueeze(2).expand(-1, -1, na, -1)[mask_gt]
        overlaps[mask_gt] = self.iou_calculation(gt_boxes, pd_boxes)  # è®¡ç®—IoU

        align_metric = bbox_scores.pow(self.alpha) * overlaps.pow(self.beta)  # è®¡ç®—å¯¹é½æŒ‡æ ‡
        return align_metric, overlaps

    def iou_calculation(self, gt_bboxes, pd_bboxes):
        """è®¡ç®—è¾¹ç•Œæ¡†çš„IoUã€‚"""
        return bbox_iou(gt_bboxes, pd_bboxes, xywh=False, CIoU=True).squeeze(-1).clamp_(0)  # è®¡ç®—IoUå¹¶é™åˆ¶åœ¨0ä»¥ä¸Š

    def select_topk_candidates(self, metrics, largest=True, topk_mask=None):
        """æ ¹æ®ç»™å®šæŒ‡æ ‡é€‰æ‹©å‰kä¸ªå€™é€‰æ¡†ã€‚"""
        topk_metrics, topk_idxs = torch.topk(metrics, self.topk, dim=-1, largest=largest)  # è·å–å‰kä¸ªæŒ‡æ ‡
        if topk_mask is None:
            topk_mask = (topk_metrics.max(-1, keepdim=True)[0] > self.eps).expand_as(topk_idxs)  # ç”Ÿæˆæ©ç 
        topk_idxs.masked_fill_(~topk_mask, 0)  # å¡«å……æ— æ•ˆç´¢å¼•

        count_tensor = torch.zeros(metrics.shape, dtype=torch.int8, device=topk_idxs.device)  # åˆå§‹åŒ–è®¡æ•°å¼ é‡
        ones = torch.ones_like(topk_idxs[:, :, :1], dtype=torch.int8, device=topk_idxs.device)  # åˆ›å»ºå…¨1å¼ é‡
        for k in range(self.topk):
            count_tensor.scatter_add_(-1, topk_idxs[:, :, k : k + 1], ones)  # ç»Ÿè®¡æ¯ä¸ªå€™é€‰æ¡†çš„å‡ºç°æ¬¡æ•°
        count_tensor.masked_fill_(count_tensor > 1, 0)  # è¿‡æ»¤æ— æ•ˆè¾¹ç•Œæ¡†

        return count_tensor.to(metrics.dtype)  # è¿”å›æœ‰æ•ˆå€™é€‰æ¡†

    def get_targets(self, gt_labels, gt_bboxes, target_gt_idx, fg_mask):
        """è®¡ç®—æ­£æ ·æœ¬çš„ç›®æ ‡æ ‡ç­¾ã€è¾¹ç•Œæ¡†å’Œå¾—åˆ†ã€‚"""
        batch_ind = torch.arange(end=self.bs, dtype=torch.int64, device=gt_labels.device)[..., None]  # æ‰¹é‡ç´¢å¼•
        target_gt_idx = target_gt_idx + batch_ind * self.n_max_boxes  # è®¡ç®—ç›®æ ‡çœŸå®ç´¢å¼•
        target_labels = gt_labels.long().flatten()[target_gt_idx]  # è·å–ç›®æ ‡æ ‡ç­¾

        target_bboxes = gt_bboxes.view(-1, gt_bboxes.shape[-1])[target_gt_idx]  # è·å–ç›®æ ‡è¾¹ç•Œæ¡†

        target_labels.clamp_(0)  # é™åˆ¶æ ‡ç­¾åœ¨æœ‰æ•ˆèŒƒå›´å†…

        target_scores = torch.zeros(
            (target_labels.shape[0], target_labels.shape[1], self.num_classes),
            dtype=torch.int64,
            device=target_labels.device,
        )  # åˆå§‹åŒ–ç›®æ ‡å¾—åˆ†
        target_scores.scatter_(2, target_labels.unsqueeze(-1), 1)  # æ ¹æ®æ ‡ç­¾å¡«å……å¾—åˆ†

        fg_scores_mask = fg_mask[:, :, None].repeat(1, 1, self.num_classes)  # æ‰©å±•å‰æ™¯æ©ç 
        target_scores = torch.where(fg_scores_mask > 0, target_scores, 0)  # ä»…ä¿ç•™å‰æ™¯å¾—åˆ†

        return target_labels, target_bboxes, target_scores  # è¿”å›ç›®æ ‡æ ‡ç­¾ã€è¾¹ç•Œæ¡†å’Œå¾—åˆ†

    @staticmethod
    def select_candidates_in_gts(xy_centers, gt_bboxes, eps=1e-9):
        """é€‰æ‹©åœ¨çœŸå®æ¡†å†…çš„æ­£æ ·æœ¬é”šæ¡†ã€‚"""
        n_anchors = xy_centers.shape[0]  # é”šæ¡†æ•°é‡
        bs, n_boxes, _ = gt_bboxes.shape  # æ‰¹é‡å¤§å°å’ŒçœŸå®æ¡†æ•°é‡
        lt, rb = gt_bboxes.view(-1, 1, 4).chunk(2, 2)  # è·å–çœŸå®æ¡†çš„å·¦ä¸Šè§’å’Œå³ä¸‹è§’
        bbox_deltas = torch.cat((xy_centers[None] - lt, rb - xy_centers[None]), dim=2).view(bs, n_boxes, n_anchors, -1)  # è®¡ç®—é”šæ¡†ä¸çœŸå®æ¡†çš„è·ç¦»
        return bbox_deltas.amin(3).gt_(eps)  # è¿”å›åœ¨çœŸå®æ¡†å†…çš„é”šæ¡†

    @staticmethod
    def select_highest_overlaps(mask_pos, overlaps, n_max_boxes):
        """é€‰æ‹©é‡å åº¦æœ€é«˜çš„çœŸå®æ¡†ã€‚"""
        fg_mask = mask_pos.sum(-2)  # è®¡ç®—å‰æ™¯æ©ç 
        if fg_mask.max() > 1:  # å¦‚æœä¸€ä¸ªé”šæ¡†è¢«å¤šä¸ªçœŸå®æ¡†åˆ†é…
            mask_multi_gts = (fg_mask.unsqueeze(1) > 1).expand(-1, n_max_boxes, -1)  # åˆ›å»ºå¤šé‡çœŸå®æ¡†æ©ç 
            max_overlaps_idx = overlaps.argmax(1)  # è·å–æœ€å¤§é‡å åº¦ç´¢å¼•

            is_max_overlaps = torch.zeros(mask_pos.shape, dtype=mask_pos.dtype, device=mask_pos.device)  # åˆå§‹åŒ–æœ€å¤§é‡å åº¦æ©ç 
            is_max_overlaps.scatter_(1, max_overlaps_idx.unsqueeze(1), 1)  # å¡«å……æœ€å¤§é‡å åº¦ä½ç½®

            mask_pos = torch.where(mask_multi_gts, is_max_overlaps, mask_pos).float()  # æ›´æ–°æ©ç 
            fg_mask = mask_pos.sum(-2)  # æ›´æ–°å‰æ™¯æ©ç 
        target_gt_idx = mask_pos.argmax(-2)  # è·å–æ¯ä¸ªé”šæ¡†å¯¹åº”çš„çœŸå®æ¡†ç´¢å¼•
        return target_gt_idx, fg_mask, mask_pos  # è¿”å›ç›®æ ‡çœŸå®ç´¢å¼•ã€å‰æ™¯æ©ç å’Œæ©ç 
```

è¿™æ®µä»£ç å®ç°äº†ä¸€ä¸ªä»»åŠ¡å¯¹é½åˆ†é…å™¨ï¼Œç”¨äºç›®æ ‡æ£€æµ‹ä¸­çš„é”šæ¡†åˆ†é…ã€‚é€šè¿‡è®¡ç®—é¢„æµ‹å¾—åˆ†ã€è¾¹ç•Œæ¡†å’ŒçœŸå®æ¡†ä¹‹é—´çš„å¯¹é½æŒ‡æ ‡ï¼Œé€‰æ‹©æœ€åˆé€‚çš„é”šæ¡†è¿›è¡Œç›®æ ‡æ£€æµ‹ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶ `ultralytics/utils/tal.py` å®ç°äº†ä¸€ä¸ªç”¨äºç›®æ ‡æ£€æµ‹çš„ä»»åŠ¡å¯¹é½åˆ†é…å™¨ï¼ˆTaskAlignedAssignerï¼‰ï¼Œå®ƒä¸»è¦ç”¨äºå°†çœŸå®ç›®æ ‡ï¼ˆground-truthï¼‰åˆ†é…ç»™é”šæ¡†ï¼ˆanchorsï¼‰ï¼Œå¹¶ç»“åˆäº†åˆ†ç±»å’Œå®šä½ä¿¡æ¯ã€‚æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸¤ä¸ªç±»ï¼š`TaskAlignedAssigner` å’Œ `RotatedTaskAlignedAssigner`ï¼Œåè€…æ˜¯å‰è€…çš„æ‰©å±•ï¼Œä¸“é—¨å¤„ç†æ—‹è½¬è¾¹ç•Œæ¡†ã€‚

åœ¨ `TaskAlignedAssigner` ç±»ä¸­ï¼Œæ„é€ å‡½æ•°åˆå§‹åŒ–äº†ä¸€äº›è¶…å‚æ•°ï¼ŒåŒ…æ‹¬è€ƒè™‘çš„å€™é€‰æ¡†æ•°é‡ï¼ˆtopkï¼‰ã€ç±»åˆ«æ•°é‡ã€åˆ†ç±»å’Œå®šä½çš„æƒé‡å‚æ•°ï¼ˆalpha å’Œ betaï¼‰ï¼Œä»¥åŠä¸€ä¸ªå°çš„é˜²æ­¢é™¤é›¶çš„å€¼ï¼ˆepsï¼‰ã€‚`forward` æ–¹æ³•æ˜¯ä¸»è¦çš„è®¡ç®—å‡½æ•°ï¼Œå®ƒæ¥å—é¢„æµ‹çš„åˆ†æ•°å’Œè¾¹ç•Œæ¡†ã€é”šç‚¹ã€çœŸå®æ ‡ç­¾å’Œè¾¹ç•Œæ¡†ç­‰è¾“å…¥ï¼Œè¿”å›ç›®æ ‡æ ‡ç­¾ã€ç›®æ ‡è¾¹ç•Œæ¡†ã€ç›®æ ‡åˆ†æ•°ã€å‰æ™¯æ©ç å’Œç›®æ ‡ç´¢å¼•ã€‚

`get_pos_mask` æ–¹æ³•ç”¨äºè·å–æ­£æ ·æœ¬çš„æ©ç ï¼Œç»“åˆäº†å€™é€‰æ¡†ä¸çœŸå®æ¡†çš„é‡å æƒ…å†µï¼Œè®¡ç®—å¯¹é½åº¦é‡ï¼ˆalignment metricï¼‰ã€‚`get_box_metrics` æ–¹æ³•è®¡ç®—é¢„æµ‹æ¡†ä¸çœŸå®æ¡†ä¹‹é—´çš„é‡å æƒ…å†µï¼Œå¹¶æ ¹æ®åˆ†ç±»åˆ†æ•°å’Œé‡å åº¦è®¡ç®—å¯¹é½åº¦é‡ã€‚`iou_calculation` æ–¹æ³•åˆ™å®ç°äº† IoUï¼ˆIntersection over Unionï¼‰è®¡ç®—ï¼Œç”¨äºè¯„ä¼°é¢„æµ‹æ¡†ä¸çœŸå®æ¡†çš„é‡å ç¨‹åº¦ã€‚

`select_topk_candidates` æ–¹æ³•æ ¹æ®ç»™å®šçš„åº¦é‡é€‰æ‹©å‰ k ä¸ªå€™é€‰æ¡†ï¼Œç¡®ä¿æ¯ä¸ªé”šæ¡†åªåˆ†é…ç»™ä¸€ä¸ªçœŸå®æ¡†ã€‚`get_targets` æ–¹æ³•åˆ™æ ¹æ®é€‰å®šçš„çœŸå®æ¡†ç´¢å¼•å’Œå‰æ™¯æ©ç è®¡ç®—ç›®æ ‡æ ‡ç­¾ã€ç›®æ ‡è¾¹ç•Œæ¡†å’Œç›®æ ‡åˆ†æ•°ã€‚

`RotatedTaskAlignedAssigner` ç±»é‡å†™äº† `iou_calculation` æ–¹æ³•ï¼Œä»¥æ”¯æŒæ—‹è½¬è¾¹ç•Œæ¡†çš„ IoU è®¡ç®—ï¼Œå¹¶å®ç°äº†é’ˆå¯¹æ—‹è½¬è¾¹ç•Œæ¡†çš„å€™é€‰æ¡†é€‰æ‹©æ–¹æ³•ã€‚

æ­¤å¤–ï¼Œæ–‡ä»¶ä¸­è¿˜å®šä¹‰äº†ä¸€äº›è¾…åŠ©å‡½æ•°ï¼Œå¦‚ `make_anchors` ç”¨äºç”Ÿæˆé”šæ¡†ï¼Œ`dist2bbox` å’Œ `bbox2dist` ç”¨äºåœ¨è¾¹ç•Œæ¡†å’Œè·ç¦»è¡¨ç¤ºä¹‹é—´è¿›è¡Œè½¬æ¢ï¼Œ`dist2rbox` ç”¨äºä»é”šç‚¹å’Œé¢„æµ‹çš„è·ç¦»åŠè§’åº¦è§£ç å‡ºæ—‹è½¬è¾¹ç•Œæ¡†ã€‚

æ•´ä½“è€Œè¨€ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº†ä¸€ä¸ªå¤æ‚çš„ç›®æ ‡æ£€æµ‹ä»»åŠ¡å¯¹é½æœºåˆ¶ï¼Œç»“åˆäº†æ·±åº¦å­¦ä¹ ä¸­çš„å¤šä¸ªé‡è¦æ¦‚å¿µï¼Œå¦‚é”šæ¡†æœºåˆ¶ã€IoU è®¡ç®—å’Œæ­£è´Ÿæ ·æœ¬çš„é€‰æ‹©ç­‰ï¼Œä¸ºç›®æ ‡æ£€æµ‹æ¨¡å‹çš„è®­ç»ƒæä¾›äº†åŸºç¡€åŠŸèƒ½ã€‚

### 12.ç³»ç»Ÿæ•´ä½“ç»“æ„ï¼ˆèŠ‚é€‰ï¼‰

### æ•´ä½“åŠŸèƒ½å’Œæ„æ¶æ¦‚æ‹¬

è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºUltralyticsæ¡†æ¶çš„è®¡ç®—æœºè§†è§‰åº”ç”¨ï¼Œä¸»è¦ç”¨äºç›®æ ‡æ£€æµ‹ã€å›¾åƒåˆ†å‰²å’Œçƒ­å›¾ç”Ÿæˆç­‰ä»»åŠ¡ã€‚é¡¹ç›®çš„æ ¸å¿ƒæ„æ¶ç”±å¤šä¸ªæ¨¡å—ç»„æˆï¼Œæ¯ä¸ªæ¨¡å—è´Ÿè´£ç‰¹å®šçš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ¨¡å‹å®šä¹‰ã€é¢„æµ‹ã€æ•°æ®å¤„ç†å’Œå¯è§†åŒ–ç­‰ã€‚æ•´ä½“ä¸Šï¼Œé¡¹ç›®æ—¨åœ¨æä¾›é«˜æ•ˆçš„æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒå’Œæ¨ç†èƒ½åŠ›ï¼Œæ”¯æŒå¤šç§è§†è§‰ä»»åŠ¡ã€‚

- **æ¨¡å‹æ¨¡å—**ï¼šå®šä¹‰äº†ä¸åŒçš„ç›®æ ‡æ£€æµ‹å’Œåˆ†å‰²æ¨¡å‹ï¼Œæä¾›äº†æ¨¡å‹çš„æ„å»ºå’Œè®­ç»ƒæ¥å£ã€‚
- **é¢„æµ‹æ¨¡å—**ï¼šå®ç°äº†å¯¹å›¾åƒå’Œè§†é¢‘æµçš„å®æ—¶é¢„æµ‹åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼ã€‚
- **å·¥å…·æ¨¡å—**ï¼šæä¾›äº†è¾…åŠ©åŠŸèƒ½ï¼Œå¦‚æ–‡ä»¶å¤„ç†ã€æ•°æ®å¢å¼ºå’Œä»»åŠ¡å¯¹é½ç­‰ï¼Œæ”¯æŒæ¨¡å‹è®­ç»ƒå’Œè¯„ä¼°ã€‚
- **ç”¨æˆ·ç•Œé¢æ¨¡å—**ï¼šæä¾›äº†ç®€å•çš„ç”¨æˆ·æ¥å£ï¼Œç”¨äºå¯åŠ¨å’Œè¿è¡Œåº”ç”¨ã€‚

### æ–‡ä»¶åŠŸèƒ½æ•´ç†è¡¨

| æ–‡ä»¶è·¯å¾„                                      | åŠŸèƒ½æè¿°                                                         |
|-----------------------------------------------|------------------------------------------------------------------|
| `ultralytics/models/rtdetr/model.py`         | å®ç°RT-DETRæ¨¡å‹çš„æ¥å£ï¼Œæ”¯æŒç›®æ ‡æ£€æµ‹ä»»åŠ¡çš„åˆå§‹åŒ–å’Œä»»åŠ¡æ˜ å°„ã€‚     |
| `ui.py`                                       | æä¾›ä¸€ä¸ªç®€å•çš„ç”¨æˆ·ç•Œé¢ï¼Œç”¨äºè¿è¡ŒæŒ‡å®šçš„Streamlitè„šæœ¬ã€‚            |
| `ultralytics/nn/modules/conv.py`             | å®šä¹‰å¤šç§å·ç§¯å±‚å’Œæ³¨æ„åŠ›æœºåˆ¶ï¼Œæ„å»ºæ·±åº¦å­¦ä¹ æ¨¡å‹çš„åŸºç¡€æ¨¡å—ã€‚        |
| `ultralytics/models/yolo/segment/predict.py`| å®ç°å›¾åƒåˆ†å‰²çš„é¢„æµ‹å™¨ï¼Œå¤„ç†æ¨¡å‹è¾“å‡ºå¹¶ç”Ÿæˆåˆ†å‰²ç»“æœã€‚              |
| `ultralytics/solutions/heatmap.py`           | ç”Ÿæˆå®æ—¶è§†é¢‘æµä¸­çš„çƒ­å›¾ï¼Œæ”¯æŒç‰©ä½“è¿½è¸ªå’Œè®¡æ•°åŠŸèƒ½ã€‚                |
| `ultralytics/utils/tal.py`                   | å®ç°ç›®æ ‡æ£€æµ‹çš„ä»»åŠ¡å¯¹é½åˆ†é…å™¨ï¼Œå¤„ç†é”šæ¡†ä¸çœŸå®ç›®æ ‡çš„åˆ†é…ã€‚        |
| `train.py`                                    | è´Ÿè´£æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ï¼ŒåŒ…å«è®­ç»ƒå¾ªç¯å’ŒæŸå¤±è®¡ç®—ç­‰åŠŸèƒ½ã€‚              |
| `ultralytics/utils/files.py`                 | æä¾›æ–‡ä»¶å¤„ç†å’Œè·¯å¾„ç®¡ç†çš„è¾…åŠ©åŠŸèƒ½ï¼Œå¦‚æ–‡ä»¶è¯»å–å’Œå†™å…¥ã€‚            |
| `ultralytics/models/yolo/pose/val.py`        | å®ç°å§¿æ€ä¼°è®¡æ¨¡å‹çš„éªŒè¯åŠŸèƒ½ï¼Œå¤„ç†éªŒè¯æ•°æ®å¹¶è®¡ç®—æ€§èƒ½æŒ‡æ ‡ã€‚        |
| `ultralytics/models/nas/predict.py`          | å®ç°ç¥ç»æ¶æ„æœç´¢ï¼ˆNASï¼‰æ¨¡å‹çš„é¢„æµ‹åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§æ¨¡å‹æ¶æ„çš„é€‰æ‹©ã€‚ |

è¿™ä¸ªè¡¨æ ¼æ€»ç»“äº†æ¯ä¸ªæ–‡ä»¶çš„ä¸»è¦åŠŸèƒ½ï¼Œå±•ç¤ºäº†é¡¹ç›®çš„æ¨¡å—åŒ–è®¾è®¡å’Œå„ä¸ªéƒ¨åˆ†ä¹‹é—´çš„åä½œå…³ç³»ã€‚

æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰â€ä¸­éƒ¨åˆ†ä»£ç å¯èƒ½ä¼šä¼˜åŒ–å‡çº§ï¼Œä»…ä¾›å‚è€ƒå­¦ä¹ ï¼Œå®Œæ•´â€œè®­ç»ƒæºç â€ã€â€œWebå‰ç«¯ç•Œé¢â€å’Œâ€œ70+ç§åˆ›æ–°ç‚¹æºç â€ä»¥â€œ13.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+70+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–â€çš„å†…å®¹ä¸ºå‡†ã€‚

### 13.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+70+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–

![19.png](19.png)

https://mbd.pub/o/bread/ZpqWlZxr

